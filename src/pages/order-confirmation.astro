---
import Layout from '../layouts/Layout.astro';
import siteData from '../data/site.json';
---

<Layout title="Order Confirmed – Vapelink Australia" description="Your order has been placed successfully. Thank you for shopping with Vapelink Australia." noindex={true}>

  <section class="container confirmation-page">
    <!-- No order data (direct visit) -->
    <div id="no-order" style="display:none;">
      <div class="confirmation-empty">
        <div class="confirmation-empty-icon">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
        </div>
        <h2 class="font-display confirmation-empty-title">No Order Found</h2>
        <p class="confirmation-empty-desc">It looks like you haven't placed an order yet, or the order details have expired.</p>
        <a href="/collections/shop" class="btn-primary confirmation-empty-btn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
          Browse Products
        </a>
      </div>
    </div>

    <!-- Order Confirmation -->
    <div id="order-content" style="display:none;">
      <!-- Success Header -->
      <div class="confirmation-header">
        <div class="confirmation-header-pattern"></div>
        <div class="confirmation-header-inner">
          <div id="conf-header-icon" class="confirmation-check">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
          </div>
          <h1 id="conf-title" class="font-display confirmation-title">Order Confirmed!</h1>
          <p id="conf-subtitle" class="confirmation-subtitle">Thank you for your order. We've received your details and will process it shortly.</p>
          <div class="confirmation-order-num">
            <span>Order Number</span>
            <strong id="conf-order-num" class="font-display">—</strong>
          </div>
        </div>
      </div>

      <!-- Payment-specific section (Bank Transfer / PayID) -->
      <div id="bank-payment-section" class="payment-instruction-section" style="display:none;">
        <div class="payment-instruction-card bank-card">
          <div class="payment-instruction-accent bank"></div>
          <div class="payment-instruction-body">
            <div class="payment-instruction-header">
              <div class="payment-instruction-icon bank">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M2 10h20"/><path d="M6 16h4"/></svg>
              </div>
              <h3 class="font-display payment-instruction-title">Bank Transfer / PayID</h3>
            </div>

            <div class="bank-pending-message">
              <div class="bank-pending-icon">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
              </div>
              <h4 class="font-display bank-pending-title">Bank Details Coming to Your Inbox</h4>
              <p class="bank-pending-desc">
                Thank you for placing your order! Our team will review it and send the <strong>bank transfer / PayID payment details</strong> to your email address shortly.
              </p>

              <div class="bank-pending-details">
                <div class="bank-pending-row">
                  <span>Order Number</span>
                  <strong id="bank-reference" class="font-display" style="color:var(--color-accent);">—</strong>
                </div>
                <div class="bank-pending-row">
                  <span>Amount Due</span>
                  <strong id="bank-amount" class="font-display" style="color:var(--color-accent);">—</strong>
                </div>
                <div class="bank-pending-row">
                  <span>Email</span>
                  <strong id="bank-pending-email" class="font-display" style="color:var(--color-text);">—</strong>
                </div>
              </div>

              <p class="bank-pending-footnote">
                <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
                Please check your inbox (and spam folder) within the next few minutes. Once you receive the payment details, complete the transfer and send a screenshot of the payment to confirm your order.
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Payment-specific section (Bitcoin) -->
      <div id="bitcoin-payment-section" class="payment-instruction-section" style="display:none;">
        <div class="payment-instruction-card bitcoin-card">
          <div class="payment-instruction-accent bitcoin"></div>
          <div class="payment-instruction-body">
            <div class="payment-instruction-header">
              <div class="payment-instruction-icon bitcoin">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M11.767 19.089c4.924.868 6.14-6.025 1.216-6.894m-1.216 6.894L5.86 18.047m5.908 1.042-.347 1.97m1.563-8.864c4.924.869 6.14-6.025 1.215-6.893m-1.215 6.893-3.94-.694m5.155-6.2L8.29 4.26m5.908 1.042.348-1.97M7.48 20.364l3.126-17.727"/></svg>
              </div>
              <h3 class="font-display payment-instruction-title">Bitcoin Payment</h3>
            </div>
            <p class="payment-instruction-desc">Scan the QR code below or copy the Bitcoin address to send your payment.</p>

            <!-- BTC Amount and Timer -->
            <div class="btc-payment-status">
              <div class="btc-amount-box">
                <span class="btc-amount-label">Amount Due (AUD)</span>
                <span id="btc-aud-amount" class="btc-amount-value font-display">$0.00</span>
              </div>
              <div class="btc-timer-box" id="btc-timer-box">
                <span class="btc-timer-label">Payment Window</span>
                <span id="btc-timer" class="btc-timer-value font-display">30:00</span>
              </div>
              <div class="btc-status-box">
                <span class="btc-status-label">Status</span>
                <span id="btc-status" class="btc-status-value">
                  <span class="btc-status-dot waiting"></span>
                  Waiting for payment...
                </span>
              </div>
            </div>

            <!-- QR Code -->
            <div class="btc-qr-container">
              <div id="btc-qr-code" class="btc-qr-code"></div>
              <p class="btc-qr-hint">Scan with your Bitcoin wallet app</p>
            </div>

            <!-- Bitcoin Address -->
            <div class="btc-address-box">
              <span class="btc-address-label">Bitcoin Address</span>
              <div class="btc-address-row">
                <code id="btc-address" class="btc-address-text">—</code>
                <button id="btc-copy-btn" class="btc-copy-btn" title="Copy to clipboard">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                  <span id="btc-copy-text">Copy</span>
                </button>
              </div>
            </div>

            <!-- Payment Progress -->
            <div id="btc-progress-section" class="btc-progress-section">
              <div class="btc-progress-bar-wrap">
                <div id="btc-progress-bar" class="btc-progress-bar"></div>
              </div>
              <div class="btc-progress-steps">
                <div class="btc-progress-step active" id="btc-step-1">
                  <span class="btc-step-dot"></span>
                  <span class="btc-step-text">Waiting</span>
                </div>
                <div class="btc-progress-step" id="btc-step-2">
                  <span class="btc-step-dot"></span>
                  <span class="btc-step-text">Detected</span>
                </div>
                <div class="btc-progress-step" id="btc-step-3">
                  <span class="btc-step-dot"></span>
                  <span class="btc-step-text">Confirmed</span>
                </div>
              </div>
            </div>

            <!-- Completed state (hidden initially) -->
            <div id="btc-completed" class="btc-completed" style="display:none;">
              <div class="btc-completed-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
              </div>
              <h4 class="font-display btc-completed-title">Payment Confirmed!</h4>
              <p class="btc-completed-desc">Your Bitcoin payment has been received and your order is now being processed.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Order Details Grid -->
      <div class="confirmation-grid">
        <!-- Order Details -->
        <div class="confirmation-details">
          <!-- Customer Info -->
          <div class="conf-section">
            <h3 class="font-display conf-section-title">
              <div class="conf-section-icon">
                <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
              </div>
              Customer Details
            </h3>
            <div class="conf-info-grid">
              <div class="conf-info-item">
                <span class="conf-label">Name</span>
                <span id="conf-name" class="conf-value">—</span>
              </div>
              <div class="conf-info-item">
                <span class="conf-label">Email</span>
                <span id="conf-email" class="conf-value">—</span>
              </div>
              <div class="conf-info-item">
                <span class="conf-label">Phone</span>
                <span id="conf-phone" class="conf-value">—</span>
              </div>
            </div>
          </div>

          <!-- Shipping -->
          <div class="conf-section">
            <h3 class="font-display conf-section-title">
              <div class="conf-section-icon">
                <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>
              </div>
              Shipping Address
            </h3>
            <p id="conf-address" class="conf-value" style="line-height:1.6;">—</p>
          </div>

          <!-- Shipping Method -->
          <div class="conf-section">
            <h3 class="font-display conf-section-title">
              <div class="conf-section-icon">
                <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="3" width="15" height="13"/><path d="m16 8 4 2v6H16"/><circle cx="5.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/></svg>
              </div>
              Delivery Method
            </h3>
            <span id="conf-shipping" class="conf-value">—</span>
          </div>

          <!-- Payment -->
          <div class="conf-section">
            <h3 class="font-display conf-section-title">
              <div class="conf-section-icon">
                <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2"/><path d="M1 10h22"/></svg>
              </div>
              Payment Method
            </h3>
            <span id="conf-payment" class="conf-value">—</span>
          </div>

          <!-- Notes -->
          <div id="conf-notes-section" class="conf-section" style="display:none;">
            <h3 class="font-display conf-section-title">
              <div class="conf-section-icon">
                <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
              </div>
              Order Notes
            </h3>
            <p id="conf-notes" class="conf-value" style="line-height:1.6;">—</p>
          </div>
        </div>

        <!-- Items Summary -->
        <div class="confirmation-items-card">
          <h3 class="font-display conf-items-heading">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--color-accent)" stroke-width="2"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
            Items Ordered
          </h3>
          <div id="conf-items" class="conf-items-list"></div>
          <hr class="conf-divider" />
          <div class="conf-total-row">
            <span>Subtotal</span>
            <span id="conf-subtotal" class="font-display" style="font-weight:600;">$0.00</span>
          </div>
          <div class="conf-total-row">
            <span>Shipping</span>
            <span id="conf-ship-cost" class="font-display" style="font-weight:600;">$0.00</span>
          </div>
          <hr class="conf-divider" />
          <div class="conf-total-row conf-grand-total">
            <span>Total</span>
            <span id="conf-total" class="font-display">$0.00 AUD</span>
          </div>
        </div>
      </div>

      <!-- Next Steps (dynamic based on payment) -->
      <div id="next-steps-bank" class="confirmation-next-steps" style="display:none;">
        <h3 class="font-display next-steps-heading">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--color-accent)" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
          What Happens Next
        </h3>
        <div class="next-steps-grid">
          <div class="next-step-card">
            <div class="next-step-number">1</div>
            <div class="next-step-content">
              <h4 class="font-display next-step-title">Check Your Email</h4>
              <p class="next-step-desc">We'll send the bank transfer details to your email address shortly. Please check your inbox and spam folder.</p>
            </div>
          </div>
          <div class="next-step-card">
            <div class="next-step-number">2</div>
            <div class="next-step-content">
              <h4 class="font-display next-step-title">Make Payment & Send Receipt</h4>
              <p class="next-step-desc">Once you receive the bank details, transfer the amount and send a screenshot of the payment to confirm your order.</p>
            </div>
          </div>
          <div class="next-step-card">
            <div class="next-step-number">3</div>
            <div class="next-step-content">
              <h4 class="font-display next-step-title">Processing & Shipping</h4>
              <p class="next-step-desc">Once we confirm your payment, we'll pack and ship within 1–2 business days. You'll get a tracking number by email.</p>
            </div>
          </div>
        </div>
      </div>

      <div id="next-steps-bitcoin" class="confirmation-next-steps" style="display:none;">
        <h3 class="font-display next-steps-heading">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#f7931a" stroke-width="2"><path d="M11.767 19.089c4.924.868 6.14-6.025 1.216-6.894m-1.216 6.894L5.86 18.047m5.908 1.042-.347 1.97m1.563-8.864c4.924.869 6.14-6.025 1.215-6.893m-1.215 6.893-3.94-.694m5.155-6.2L8.29 4.26m5.908 1.042.348-1.97M7.48 20.364l3.126-17.727"/></svg>
          What Happens Next
        </h3>
        <div class="next-steps-grid">
          <div class="next-step-card">
            <div class="next-step-number btc">1</div>
            <div class="next-step-content">
              <h4 class="font-display next-step-title">Send Bitcoin Payment</h4>
              <p class="next-step-desc">Scan the QR code or copy the Bitcoin address above and send the exact amount from your wallet.</p>
            </div>
          </div>
          <div class="next-step-card">
            <div class="next-step-number btc">2</div>
            <div class="next-step-content">
              <h4 class="font-display next-step-title">Automatic Detection</h4>
              <p class="next-step-desc">Our system will automatically detect your payment. Stay on this page to see real-time confirmation status.</p>
            </div>
          </div>
          <div class="next-step-card">
            <div class="next-step-number btc">3</div>
            <div class="next-step-content">
              <h4 class="font-display next-step-title">Keep Your Order Number</h4>
              <p class="next-step-desc">Save this page and your order number so our team can quickly assist you if needed.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="confirmation-actions">
        <a href="/collections/shop" class="btn-primary confirmation-action-btn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
          Continue Shopping
        </a>
        <a href="/" class="btn-secondary confirmation-action-btn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
          Back to Home
        </a>
      </div>
    </div>
  </section>

  <style is:global>
    .confirmation-page {
      padding-top: 1.5rem;
      padding-bottom: 4rem;
      min-height: 60vh;
    }

    /* ── Empty State ── */
    .confirmation-empty {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      padding: 5rem 1rem;
    }
    .confirmation-empty-icon {
      width: 72px;
      height: 72px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--color-surface-alt);
      border: 1px solid var(--color-border);
      border-radius: 50%;
      color: var(--color-text-dim);
      margin-bottom: 1.25rem;
    }
    .confirmation-empty-title {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--color-text);
    }
    .confirmation-empty-desc {
      color: var(--color-text-secondary);
      font-size: 0.88rem;
      margin-top: 0.35rem;
      max-width: 400px;
    }
    .confirmation-empty-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      margin-top: 1.5rem;
      padding: 0.75rem 2rem;
    }

    /* ── Success Header ── */
    .confirmation-header {
      position: relative;
      text-align: center;
      margin-bottom: 2.5rem;
      padding: 3rem 1.5rem 2.5rem;
      background: linear-gradient(180deg, #F0FDF4 0%, #DCFCE7 50%, var(--color-bg) 100%);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-xl);
      overflow: hidden;
    }
    [data-theme="dark"] .confirmation-header {
      background: linear-gradient(180deg, rgba(22,163,74,0.08) 0%, rgba(22,163,74,0.03) 50%, var(--color-surface) 100%);
    }
    .confirmation-header-pattern {
      position: absolute;
      inset: 0;
      background-image: radial-gradient(circle at 1px 1px, rgba(22,163,74,0.06) 1px, transparent 0);
      background-size: 28px 28px;
      pointer-events: none;
    }
    .confirmation-header-inner { position: relative; z-index: 1; }
    .confirmation-check {
      width: 68px;
      height: 68px;
      border-radius: 50%;
      background: var(--color-accent);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1.25rem;
      box-shadow: 0 6px 24px rgba(22, 163, 74, 0.35);
    }
    .confirmation-check.btc-waiting {
      background: #f7931a;
      box-shadow: 0 6px 24px rgba(247, 147, 26, 0.35);
    }
    .confirmation-title {
      font-size: clamp(1.5rem, 3.5vw, 1.85rem);
      font-weight: 800;
      color: var(--color-text);
      letter-spacing: -0.02em;
    }
    .confirmation-subtitle {
      color: var(--color-text-secondary);
      font-size: 0.92rem;
      margin-top: 0.5rem;
      max-width: 520px;
      margin-left: auto;
      margin-right: auto;
      line-height: 1.65;
    }
    .confirmation-order-num {
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      gap: 0.3rem;
      margin-top: 1.5rem;
      padding: 0.85rem 2rem;
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-lg);
      box-shadow: 0 2px 12px rgba(0,0,0,0.04);
    }
    .confirmation-order-num span {
      font-size: 0.7rem;
      font-weight: 600;
      color: var(--color-text-muted);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }
    .confirmation-order-num strong {
      font-size: 1.2rem;
      color: var(--color-accent);
    }

    /* ── Payment Instruction Cards ── */
    .payment-instruction-section {
      margin-bottom: 2rem;
    }
    .payment-instruction-card {
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-xl);
      overflow: hidden;
    }
    .payment-instruction-accent {
      height: 3px;
    }
    .payment-instruction-accent.bank {
      background: linear-gradient(90deg, var(--color-accent), #059669);
    }
    .payment-instruction-accent.bitcoin {
      background: linear-gradient(90deg, #f7931a, #f59e0b);
    }
    .payment-instruction-body {
      padding: 2rem;
    }
    .payment-instruction-header {
      display: flex;
      align-items: center;
      gap: 0.85rem;
      margin-bottom: 1rem;
    }
    .payment-instruction-icon {
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-lg);
      flex-shrink: 0;
    }
    .payment-instruction-icon.bank {
      background: linear-gradient(135deg, #F0FDF4, #DCFCE7);
      color: var(--color-accent);
    }
    [data-theme="dark"] .payment-instruction-icon.bank {
      background: rgba(22,163,74,0.12);
    }
    .payment-instruction-icon.bitcoin {
      background: linear-gradient(135deg, #FEF3C7, #FDE68A);
      color: #f7931a;
    }
    [data-theme="dark"] .payment-instruction-icon.bitcoin {
      background: rgba(247,147,26,0.12);
    }
    .payment-instruction-title {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--color-text);
    }
    .payment-instruction-desc {
      font-size: 0.88rem;
      color: var(--color-text-secondary);
      margin-bottom: 1.5rem;
      line-height: 1.6;
    }

    /* Bank Pending Message */
    .bank-pending-message {
      text-align: center;
      padding: 1.5rem 1rem;
    }
    .bank-pending-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 76px;
      height: 76px;
      border-radius: 50%;
      background: var(--color-accent-soft);
      color: var(--color-accent);
      margin: 0 auto;
    }
    .bank-pending-title {
      font-size: 1.08rem;
      font-weight: 700;
      color: var(--color-text);
      margin-top: 1rem;
    }
    .bank-pending-desc {
      color: var(--color-text-secondary);
      font-size: 0.9rem;
      line-height: 1.7;
      margin-top: 0.65rem;
      max-width: 480px;
      margin-left: auto;
      margin-right: auto;
    }
    .bank-pending-desc strong {
      color: var(--color-text);
    }
    .bank-pending-details {
      display: flex;
      flex-direction: column;
      gap: 0;
      margin: 1.5rem auto 0;
      max-width: 380px;
      background: var(--color-surface-alt);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-lg);
      overflow: hidden;
    }
    .bank-pending-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.85rem 1.15rem;
      border-bottom: 1px solid var(--color-border);
      font-size: 0.88rem;
    }
    .bank-pending-row:last-child { border-bottom: none; }
    .bank-pending-row span {
      color: var(--color-text-secondary);
      font-weight: 500;
    }
    .bank-pending-footnote {
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
      color: var(--color-text-muted);
      font-size: 0.8rem;
      margin-top: 1.25rem;
      line-height: 1.6;
      text-align: left;
      max-width: 480px;
      margin-left: auto;
      margin-right: auto;
    }
    .bank-pending-footnote svg {
      flex-shrink: 0;
      margin-top: 0.2rem;
    }

    /* ── Bitcoin Payment ── */
    .btc-payment-status {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }
    @media (max-width: 640px) {
      .btc-payment-status { grid-template-columns: 1fr; }
    }
    .btc-amount-box, .btc-timer-box, .btc-status-box {
      background: var(--color-surface-alt);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-lg);
      padding: 1rem;
      text-align: center;
    }
    .btc-amount-label, .btc-timer-label, .btc-status-label {
      display: block;
      font-size: 0.7rem;
      font-weight: 600;
      color: var(--color-text-muted);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      margin-bottom: 0.35rem;
    }
    .btc-amount-value {
      font-size: 1.25rem;
      font-weight: 800;
      color: var(--color-text);
    }
    .btc-timer-value {
      font-size: 1.25rem;
      font-weight: 800;
      color: #f7931a;
    }
    .btc-timer-value.expired { color: var(--color-sale); }
    .btc-status-value {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.4rem;
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--color-text);
    }
    .btc-status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
    }
    .btc-status-dot.waiting {
      background: #f7931a;
      animation: pulse-dot 1.5s ease-in-out infinite;
    }
    .btc-status-dot.detected {
      background: #3b82f6;
      animation: pulse-dot 0.8s ease-in-out infinite;
    }
    .btc-status-dot.confirmed {
      background: var(--color-accent);
      animation: none;
    }
    @keyframes pulse-dot {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.3); }
    }

    /* QR Code */
    .btc-qr-container {
      text-align: center;
      margin-bottom: 1.5rem;
    }
    .btc-qr-code {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 200px;
      height: 200px;
      background: #fff;
      border: 2px solid var(--color-border);
      border-radius: var(--radius-lg);
      padding: 12px;
      margin: 0 auto;
    }
    .btc-qr-code img, .btc-qr-code canvas {
      max-width: 100%;
      max-height: 100%;
    }
    .btc-qr-hint {
      font-size: 0.75rem;
      color: var(--color-text-muted);
      margin-top: 0.5rem;
    }

    /* Bitcoin Address */
    .btc-address-box {
      margin-bottom: 1.5rem;
    }
    .btc-address-label {
      display: block;
      font-size: 0.72rem;
      font-weight: 600;
      color: var(--color-text-muted);
      text-transform: uppercase;
      letter-spacing: 0.04em;
      margin-bottom: 0.4rem;
    }
    .btc-address-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: var(--color-surface-alt);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-lg);
      padding: 0.85rem 1rem;
    }
    .btc-address-text {
      flex: 1;
      font-size: 0.82rem;
      font-family: 'Space Grotesk', monospace;
      color: var(--color-text);
      word-break: break-all;
      line-height: 1.4;
    }
    .btc-copy-btn {
      display: flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.5rem 0.95rem;
      background: var(--color-accent);
      color: #fff;
      border: none;
      border-radius: var(--radius-md);
      font-size: 0.78rem;
      font-weight: 600;
      cursor: pointer;
      white-space: nowrap;
      transition: background 0.15s, transform 0.15s;
    }
    .btc-copy-btn:hover {
      background: var(--color-accent-hover, #15803d);
      transform: translateY(-1px);
    }

    /* BTC Progress */
    .btc-progress-section {
      margin-bottom: 1.5rem;
    }
    .btc-progress-bar-wrap {
      height: 5px;
      background: var(--color-border);
      border-radius: 5px;
      overflow: hidden;
      margin-bottom: 0.75rem;
    }
    .btc-progress-bar {
      width: 10%;
      height: 100%;
      background: #f7931a;
      border-radius: 5px;
      transition: width 0.5s ease, background 0.3s;
    }
    .btc-progress-bar.confirmed {
      background: var(--color-accent);
    }
    .btc-progress-steps {
      display: flex;
      justify-content: space-between;
    }
    .btc-progress-step {
      display: flex;
      align-items: center;
      gap: 0.35rem;
      font-size: 0.75rem;
      color: var(--color-text-muted);
      font-weight: 600;
    }
    .btc-progress-step.active { color: #f7931a; }
    .btc-progress-step.completed { color: var(--color-accent); }
    .btc-step-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--color-border);
      transition: background 0.3s;
    }
    .btc-progress-step.active .btc-step-dot { background: #f7931a; }
    .btc-progress-step.completed .btc-step-dot { background: var(--color-accent); }

    .btc-completed {
      text-align: center;
      padding: 1.75rem;
    }
    .btc-completed-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--color-accent);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 6px 24px rgba(22, 163, 74, 0.35);
    }
    .btc-completed-title {
      font-size: 1.05rem;
      font-weight: 700;
      color: var(--color-text);
      margin-top: 0.85rem;
    }
    .btc-completed-desc {
      font-size: 0.85rem;
      color: var(--color-text-secondary);
      margin-top: 0.3rem;
    }

    /* ── Grid ── */
    .confirmation-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 2rem;
      margin-bottom: 2.5rem;
    }
    @media (min-width: 1024px) {
      .confirmation-grid {
        grid-template-columns: 1fr 380px;
        gap: 2.5rem;
      }
    }

    /* ── Details ── */
    .confirmation-details {
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-xl);
      padding: 1.75rem;
    }

    /* ── Sections ── */
    .conf-section {
      padding: 1.15rem 0;
      border-bottom: 1px solid var(--color-border);
    }
    .conf-section:first-child { padding-top: 0; }
    .conf-section:last-child { border-bottom: none; padding-bottom: 0; }
    .conf-section-title {
      display: flex;
      align-items: center;
      gap: 0.55rem;
      font-size: 0.88rem;
      font-weight: 700;
      color: var(--color-text);
      margin-bottom: 0.65rem;
    }
    .conf-section-icon {
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #F0FDF4, #DCFCE7);
      border-radius: var(--radius-md);
      color: var(--color-accent);
      flex-shrink: 0;
    }
    [data-theme="dark"] .conf-section-icon {
      background: rgba(22,163,74,0.1);
    }
    .conf-info-grid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 0.75rem;
    }
    @media (max-width: 640px) {
      .conf-info-grid { grid-template-columns: 1fr; }
    }
    .conf-info-item {
      padding: 0.65rem 0.75rem;
      background: var(--color-surface-alt);
      border-radius: var(--radius-md);
      border: 1px solid var(--color-border);
    }
    .conf-label {
      display: block;
      font-size: 0.7rem;
      font-weight: 600;
      color: var(--color-text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.2rem;
    }
    .conf-value {
      font-size: 0.88rem;
      color: var(--color-text);
    }

    /* ── Items Card ── */
    .confirmation-items-card {
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-xl);
      padding: 1.75rem;
      height: fit-content;
    }
    .conf-items-heading {
      display: flex;
      align-items: center;
      gap: 0.55rem;
      font-size: 0.92rem;
      font-weight: 700;
      color: var(--color-text);
      margin-bottom: 1rem;
    }
    .conf-items-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    .conf-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.5rem;
      background: var(--color-surface-alt);
      border-radius: var(--radius-md);
      border: 1px solid var(--color-border);
    }
    .conf-item-img {
      width: 48px;
      height: 48px;
      object-fit: contain;
      border-radius: var(--radius-sm);
      border: 1px solid var(--color-border);
      background: var(--color-surface);
      flex-shrink: 0;
    }
    .conf-item-info {
      flex: 1;
      min-width: 0;
    }
    .conf-item-title {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--color-text);
      display: -webkit-box;
      -webkit-line-clamp: 1;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .conf-item-qty {
      font-size: 0.72rem;
      color: var(--color-text-muted);
      margin-top: 0.15rem;
    }
    .conf-item-price {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.85rem;
      font-weight: 700;
      color: var(--color-text);
      flex-shrink: 0;
    }
    .conf-divider {
      border: none;
      border-top: 1px solid var(--color-border);
      margin: 0.75rem 0;
    }
    .conf-total-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.35rem 0;
      font-size: 0.85rem;
      color: var(--color-text-secondary);
    }
    .conf-grand-total {
      margin-top: 0.25rem;
      padding: 0.75rem;
      background: linear-gradient(135deg, #F0FDF4, #DCFCE7);
      border-radius: var(--radius-md);
    }
    [data-theme="dark"] .conf-grand-total {
      background: rgba(22,163,74,0.08);
    }
    .conf-grand-total span:first-child {
      font-size: 1rem;
      font-weight: 700;
      color: var(--color-text);
    }
    .conf-grand-total span:last-child {
      font-size: 1.15rem;
      font-weight: 800;
      color: var(--color-accent);
    }

    /* ── Next Steps ── */
    .confirmation-next-steps {
      margin-bottom: 2.5rem;
    }
    .next-steps-heading {
      display: flex;
      align-items: center;
      gap: 0.55rem;
      font-size: 1rem;
      font-weight: 700;
      color: var(--color-text);
      margin-bottom: 1rem;
    }
    .next-steps-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 0.85rem;
    }
    @media (min-width: 768px) {
      .next-steps-grid { grid-template-columns: repeat(3, 1fr); }
    }
    .next-step-card {
      display: flex;
      gap: 0.85rem;
      align-items: flex-start;
      padding: 1.25rem;
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-xl);
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    .next-step-card:hover {
      border-color: rgba(22,163,74,0.25);
      box-shadow: 0 4px 16px rgba(22,163,74,0.06);
    }
    .next-step-number {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--color-accent), #059669);
      color: #fff;
      font-family: var(--font-display);
      font-size: 0.78rem;
      font-weight: 800;
      border-radius: 50%;
      flex-shrink: 0;
    }
    .next-step-number.btc {
      background: linear-gradient(135deg, #f7931a, #f59e0b);
    }
    .next-step-content { flex: 1; }
    .next-step-title {
      font-size: 0.88rem;
      font-weight: 700;
      color: var(--color-text);
    }
    .next-step-desc {
      font-size: 0.78rem;
      color: var(--color-text-secondary);
      margin-top: 0.2rem;
      line-height: 1.6;
    }

    /* ── Actions ── */
    .confirmation-actions {
      display: flex;
      justify-content: center;
      gap: 1rem;
      flex-wrap: wrap;
    }
    .confirmation-action-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 2rem;
      text-decoration: none;
    }
  </style>

  <script>
    const shippingLabels: Record<string, string> = {
      standard: 'Standard Shipping (5–10 business days)',
      express: 'Express Shipping (2–4 business days)'
    };
    const shippingPrices: Record<string, number> = { standard: 9.95, express: 14.95 };
    const paymentLabels: Record<string, string> = {
      bank: 'Bank Transfer / PayID',
      bitcoin: 'Bitcoin (BTC)'
    };

    let btcTimerInterval: any = null;

    function renderConfirmation() {
      const orderStr = localStorage.getItem('vapelink_last_order');
      const noEl = document.getElementById('no-order');
      const contentEl = document.getElementById('order-content');
      if (!noEl || !contentEl) return;

      if (!orderStr) {
        noEl.style.display = 'block';
        contentEl.style.display = 'none';
        return;
      }

      let order;
      try {
        order = JSON.parse(orderStr);
      } catch {
        noEl.style.display = 'block';
        contentEl.style.display = 'none';
        return;
      }

      noEl.style.display = 'none';
      contentEl.style.display = 'block';

      // Order number
      const orderNumEl = document.getElementById('conf-order-num');
      if (orderNumEl) orderNumEl.textContent = order.orderNumber || '—';

      // Customer
      const nameEl = document.getElementById('conf-name');
      const emailEl = document.getElementById('conf-email');
      const phoneEl = document.getElementById('conf-phone');
      if (nameEl) nameEl.textContent = `${order.firstName} ${order.lastName}`;
      if (emailEl) emailEl.textContent = order.email || '—';
      if (phoneEl) phoneEl.textContent = order.phone || 'Not provided';

      // Address
      const addrEl = document.getElementById('conf-address');
      if (addrEl) {
        const parts = [order.address, order.address2, order.city, `${order.state} ${order.postcode}`, 'Australia'].filter(Boolean);
        addrEl.textContent = parts.join(', ');
      }

      // Shipping
      const shipEl = document.getElementById('conf-shipping');
      if (shipEl) {
        const label = shippingLabels[order.shipping] || order.shipping;
        shipEl.textContent = label;
      }

      // Payment
      const payEl = document.getElementById('conf-payment');
      if (payEl) payEl.textContent = paymentLabels[order.payment] || order.payment;

      // Notes
      if (order.notes) {
        const notesSection = document.getElementById('conf-notes-section');
        const notesEl = document.getElementById('conf-notes');
        if (notesSection) notesSection.style.display = 'block';
        if (notesEl) notesEl.textContent = order.notes;
      }

      // Items
      const itemsEl = document.getElementById('conf-items');
      let subtotal = 0;
      if (itemsEl && order.items) {
        itemsEl.innerHTML = order.items.map((item: any) => {
          const lineTotal = parseFloat(item.price || '0') * (item.qty || 1);
          subtotal += lineTotal;
          return `
            <div class="conf-item">
              ${item.image ? `<img src="${item.image}" alt="${item.title || 'Order product image'}" class="conf-item-img" onerror="this.style.display='none'" />` : ''}
              <div class="conf-item-info">
                <div class="conf-item-title">${item.title}</div>
                <div class="conf-item-qty">Qty: ${item.qty || 1} × $${parseFloat(item.price || '0').toFixed(2)}</div>
              </div>
              <span class="conf-item-price">$${lineTotal.toFixed(2)}</span>
            </div>
          `;
        }).join('');
      }

      // Shipping cost — always show the price
      const shipCost = typeof order.shippingCost === 'number' ? order.shippingCost : (shippingPrices[order.shipping] || 0);
      const subtotalEl = document.getElementById('conf-subtotal');
      const shipCostEl = document.getElementById('conf-ship-cost');
      const totalEl = document.getElementById('conf-total');
      if (subtotalEl) subtotalEl.textContent = `$${subtotal.toFixed(2)}`;
      if (shipCostEl) shipCostEl.textContent = `$${shipCost.toFixed(2)}`;
      const grandTotal = subtotal + shipCost;
      if (totalEl) totalEl.textContent = `$${grandTotal.toFixed(2)} AUD`;

      // ═══ Payment-specific rendering ═══
      if (order.payment === 'bank') {
        renderBankPayment(order, grandTotal);
      } else if (order.payment === 'bitcoin') {
        renderBitcoinPayment(order, grandTotal);
      }
    }

    function renderBankPayment(order: any, total: number) {
      // Update header
      const titleEl = document.getElementById('conf-title');
      const subtitleEl = document.getElementById('conf-subtitle');
      if (titleEl) titleEl.textContent = 'Order Placed Successfully!';
      if (subtitleEl) subtitleEl.textContent = 'Your order has been received. We will send you the bank transfer details to your email shortly so you can complete the payment.';

      // Show bank section
      const bankSection = document.getElementById('bank-payment-section');
      if (bankSection) bankSection.style.display = 'block';

      // Fill summary details (no bank info exposed)
      const amountEl = document.getElementById('bank-amount');
      const refEl = document.getElementById('bank-reference');
      const pendingEmailEl = document.getElementById('bank-pending-email');
      if (amountEl) amountEl.textContent = `$${total.toFixed(2)} AUD`;
      if (refEl) refEl.textContent = order.orderNumber || '—';
      if (pendingEmailEl) pendingEmailEl.textContent = order.email || '—';

      // Show bank next steps
      const bankSteps = document.getElementById('next-steps-bank');
      if (bankSteps) bankSteps.style.display = 'block';
    }

    function renderBitcoinPayment(order: any, total: number) {
      // Update header
      const headerIcon = document.getElementById('conf-header-icon');
      const titleEl = document.getElementById('conf-title');
      const subtitleEl = document.getElementById('conf-subtitle');
      if (headerIcon) headerIcon.classList.add('btc-waiting');
      if (titleEl) titleEl.textContent = 'Awaiting Bitcoin Payment';
      if (subtitleEl) subtitleEl.textContent = 'Please send the exact amount to the Bitcoin address below. Your order will be confirmed automatically once payment is detected.';

      // Show bitcoin section
      const btcSection = document.getElementById('bitcoin-payment-section');
      if (btcSection) btcSection.style.display = 'block';

      // AUD amount
      const audEl = document.getElementById('btc-aud-amount');
      if (audEl) audEl.textContent = `$${total.toFixed(2)}`;

      // Bitcoin address
      const btcAddr = order.bitcoinAddress || '';
      const addrEl = document.getElementById('btc-address');
      if (addrEl) addrEl.textContent = btcAddr;

      // Generate QR code (using a simple QR code via an external API)
      const qrEl = document.getElementById('btc-qr-code');
      if (qrEl && btcAddr) {
        const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=176x176&data=bitcoin:${encodeURIComponent(btcAddr)}&format=svg`;
        qrEl.innerHTML = `<img src="${qrUrl}" alt="Bitcoin QR Code" width="176" height="176" style="border-radius:4px;" />`;
      }

      // Copy button
      const copyBtn = document.getElementById('btc-copy-btn');
      const copyText = document.getElementById('btc-copy-text');
      copyBtn?.addEventListener('click', () => {
        navigator.clipboard.writeText(btcAddr).then(() => {
          if (copyText) copyText.textContent = 'Copied!';
          setTimeout(() => { if (copyText) copyText.textContent = 'Copy'; }, 2000);
        }).catch(() => {
          // Fallback
          const ta = document.createElement('textarea');
          ta.value = btcAddr;
          document.body.appendChild(ta);
          ta.select();
          document.execCommand('copy');
          document.body.removeChild(ta);
          if (copyText) copyText.textContent = 'Copied!';
          setTimeout(() => { if (copyText) copyText.textContent = 'Copy'; }, 2000);
        });
      });

      // Start payment timer (30 minutes)
      startBtcTimer(order);

      // Show bitcoin next steps
      const btcSteps = document.getElementById('next-steps-bitcoin');
      if (btcSteps) btcSteps.style.display = 'block';
    }

    function startBtcTimer(order: any) {
      const PAYMENT_WINDOW = 30 * 60; // 30 minutes in seconds
      const orderTime = new Date(order.date).getTime();
      const timerEl = document.getElementById('btc-timer');
      const statusEl = document.getElementById('btc-status');

      // Simulated payment detection timing (demo: triggers after random 45-120 seconds)
      const detectDelay = 45000 + Math.random() * 75000;
      const confirmDelay = detectDelay + 15000 + Math.random() * 20000;

      let paymentDetected = false;
      let paymentConfirmed = false;

      // Payment detection simulation
      setTimeout(() => {
        if (paymentConfirmed) return;
        paymentDetected = true;
        onPaymentDetected(order);
      }, detectDelay);

      // Payment confirmation simulation
      setTimeout(() => {
        paymentConfirmed = true;
        onPaymentConfirmed(order);
      }, confirmDelay);

      btcTimerInterval = setInterval(() => {
        if (paymentConfirmed) {
          clearInterval(btcTimerInterval);
          return;
        }

        const elapsed = Math.floor((Date.now() - orderTime) / 1000);
        const remaining = Math.max(0, PAYMENT_WINDOW - elapsed);
        const mins = Math.floor(remaining / 60);
        const secs = remaining % 60;

        if (timerEl) {
          timerEl.textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
          if (remaining <= 300) timerEl.classList.add('expired');
        }

        if (remaining <= 0 && !paymentDetected) {
          clearInterval(btcTimerInterval);
          if (timerEl) timerEl.textContent = 'EXPIRED';
          if (statusEl) statusEl.innerHTML = '<span class="btc-status-dot" style="background:var(--color-sale);animation:none;"></span> Payment window expired';
        }
      }, 1000);
    }

    function onPaymentDetected(order: any) {
      // Update status
      const statusEl = document.getElementById('btc-status');
      if (statusEl) statusEl.innerHTML = '<span class="btc-status-dot detected"></span> Payment detected — confirming...';

      // Update progress
      const progressBar = document.getElementById('btc-progress-bar');
      if (progressBar) progressBar.style.width = '60%';

      const step1 = document.getElementById('btc-step-1');
      const step2 = document.getElementById('btc-step-2');
      if (step1) { step1.classList.remove('active'); step1.classList.add('completed'); }
      if (step2) step2.classList.add('active');

      // Update header
      const titleEl = document.getElementById('conf-title');
      if (titleEl) titleEl.textContent = 'Payment Detected!';
    }

    function onPaymentConfirmed(order: any) {
      if (btcTimerInterval) clearInterval(btcTimerInterval);

      // Update status
      const statusEl = document.getElementById('btc-status');
      if (statusEl) statusEl.innerHTML = '<span class="btc-status-dot confirmed"></span> Payment confirmed!';

      // Update progress
      const progressBar = document.getElementById('btc-progress-bar');
      if (progressBar) {
        progressBar.style.width = '100%';
        progressBar.classList.add('confirmed');
      }

      const step1 = document.getElementById('btc-step-1');
      const step2 = document.getElementById('btc-step-2');
      const step3 = document.getElementById('btc-step-3');
      if (step1) { step1.classList.remove('active'); step1.classList.add('completed'); }
      if (step2) { step2.classList.remove('active'); step2.classList.add('completed'); }
      if (step3) step3.classList.add('completed');

      // Update header
      const headerIcon = document.getElementById('conf-header-icon');
      const titleEl = document.getElementById('conf-title');
      const subtitleEl = document.getElementById('conf-subtitle');
      if (headerIcon) { headerIcon.classList.remove('btc-waiting'); }
      if (titleEl) titleEl.textContent = 'Payment Confirmed!';
      if (subtitleEl) subtitleEl.textContent = 'Your Bitcoin payment has been received. Your order is now being processed and will ship soon.';

      // Show completed state, hide timer
      const timerBox = document.getElementById('btc-timer-box');
      if (timerBox) timerBox.style.display = 'none';
      const completedEl = document.getElementById('btc-completed');
      if (completedEl) completedEl.style.display = 'block';

      // Update timer display
      const timerEl = document.getElementById('btc-timer');
      if (timerEl) timerEl.textContent = '✓';

      // Update order status in localStorage
      try {
        const orderStr = localStorage.getItem('vapelink_last_order');
        if (orderStr) {
          const updatedOrder = JSON.parse(orderStr);
          updatedOrder.status = 'confirmed';
          localStorage.setItem('vapelink_last_order', JSON.stringify(updatedOrder));

          // Also update in order history (guest email key)
          const emailForHistory = (updatedOrder.email || '').trim().toLowerCase();
          if (emailForHistory) {
            const ordersKey = `vapelink_orders_${emailForHistory}`;
            const orders = JSON.parse(localStorage.getItem(ordersKey) || '[]');
            const idx = orders.findIndex((o: any) => o.orderNumber === updatedOrder.orderNumber);
            if (idx !== -1) {
              orders[idx].status = 'confirmed';
              localStorage.setItem(ordersKey, JSON.stringify(orders));
            }
          }
        }
      } catch {}
    }

    renderConfirmation();
  </script>

</Layout>

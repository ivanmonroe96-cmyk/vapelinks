---
import Layout from '../../layouts/Layout.astro';
import CollectionCard from '../../components/CollectionCard.astro';
import collectionsData from '../../data/collections.json';

const collections = collectionsData
  .filter((c: any) => c.products_count > 0)
  .sort((a: any, b: any) => b.products_count - a.products_count);

const emptyCollections = collectionsData
  .filter((c: any) => c.products_count === 0)
  .sort((a: any, b: any) => a.title.localeCompare(b.title));
---

<Layout title="Vape Collections | Browse by Brand & Category – Vapelink Australia" description="All our vape collections in one spot. Search by brand, category or product type — kits, e-liquids, disposables, coils, accessories and more.">

  <Fragment slot="head">
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "CollectionPage",
      "name": "All Vape Collections",
      "description": "All vape collections at Vapelink Australia. Search by brand, category or product type.",
      "url": "https://vapelink.com.au/collections",
      "numberOfItems": collections.length,
      "isPartOf": { "@type": "WebSite", "@id": "https://vapelink.com.au/#website" },
      "breadcrumb": {
        "@type": "BreadcrumbList",
        "itemListElement": [
          { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://vapelink.com.au/" },
          { "@type": "ListItem", "position": 2, "name": "Collections", "item": "https://vapelink.com.au/collections" }
        ]
      },
      "mainEntity": {
        "@type": "ItemList",
        "numberOfItems": collections.length,
        "itemListElement": collections.map((c: any, idx: number) => ({
          "@type": "ListItem",
          "position": idx + 1,
          "url": `https://vapelink.com.au/collections/${c.handle}`,
          "name": c.title,
          "image": c.image?.src || ''
        }))
      }
    })} />
  </Fragment>

  <!-- Header -->
  <section class="page-header">
    <div class="container">
      <nav style="margin-bottom:1rem;">
        <ol class="breadcrumb">
          <li><a href="/">Home</a></li>
          <li><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m9 18 6-6-6-6"/></svg></li>
          <li><span class="breadcrumb-current">Collections</span></li>
        </ol>
      </nav>
      <span class="section-label">{collections.length} collections</span>
      <h1 class="font-display page-title">All Collections</h1>
    </div>
  </section>

  <!-- Collections Grid -->
  <section class="container" style="padding:2rem 0 4rem;">
    <div class="collections-grid stagger-children">
      {collections.map((collection: any) => (
        <CollectionCard collection={collection} />
      ))}
    </div>

    {emptyCollections.length > 0 && (
      <div style="margin-top:3rem;">
        <hr style="border:none;border-top:1px solid var(--color-border);margin-bottom:1.75rem;" />
        <h2 class="font-display" style="font-size:1rem;font-weight:600;color:var(--color-text);margin-bottom:1rem;">Other Collections</h2>
        <div class="tags-wrap">
          {emptyCollections.map((c: any) => (
            <a href={`/collections/${c.handle}`} class="tag-pill">{c.title}</a>
          ))}
        </div>
      </div>
    )}
  </section>
</Layout>

<style>
  .page-header {
    background: linear-gradient(180deg, var(--color-surface) 0%, var(--color-bg) 100%);
    border-bottom: 1px solid var(--color-border);
    padding: 3rem 0 2rem;
  }
  .page-title {
    font-size: clamp(1.7rem, 4vw, 2.2rem);
    font-weight: 800;
    color: var(--color-text);
    margin-top: 0.3rem;
    letter-spacing: -0.02em;
  }

  .breadcrumb {
    display: flex;
    align-items: center;
    gap: 0.45rem;
    font-size: 0.8rem;
    list-style: none;
  }
  .breadcrumb a {
    color: var(--color-text-secondary);
    text-decoration: none;
    transition: color 0.15s ease;
  }
  .breadcrumb a:hover { color: var(--color-accent); }
  .breadcrumb svg { color: var(--color-text-dim); }
  .breadcrumb-current { color: var(--color-text); font-weight: 500; }

  .collections-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1rem;
  }
  @media (min-width: 640px) { .collections-grid { grid-template-columns: repeat(2, 1fr); } }
  @media (min-width: 1024px) { .collections-grid { grid-template-columns: repeat(3, 1fr); } }

  .tags-wrap {
    display: flex;
    flex-wrap: wrap;
    gap: 0.4rem;
  }
  .tag-pill {
    padding: 0.4rem 0.9rem;
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-full);
    font-size: 0.8rem;
    color: var(--color-text-secondary);
    text-decoration: none;
    transition: all 0.15s ease;
  }
  .tag-pill:hover {
    border-color: var(--color-accent);
    color: var(--color-accent);
    background: var(--color-accent-soft);
  }
</style>

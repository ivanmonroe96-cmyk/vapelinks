---
import '../styles/global.css';

interface Props {
  title: string;
  description?: string;
  image?: string;
  canonicalUrl?: string;
  type?: string;
  noindex?: boolean;
}

const {
  title,
  description = "Vapelink is a Melbourne-based online vape shop. We stock vape kits, disposable vapes, e-liquids, coils, pods and accessories. Fast Australia-wide shipping with Standard & Express delivery options.",
  image = '/images/hero-bg.jpg',
  canonicalUrl,
  type = 'website',
  noindex = false
} = Astro.props;

const siteTitle = title.includes('Vapelink') ? title : `${title} – Vapelink Australia`;
const currentUrl = canonicalUrl || Astro.url.href;

function cleanMetaText(value: string) {
  return String(value || '')
    .replace(/<[^>]*>/g, ' ')
    .replace(/\s+/g, ' ')
    .trim();
}

function trimAtWord(value: string, maxLen: number) {
  if (value.length <= maxLen) return value;
  const cut = value.slice(0, maxLen - 1);
  const lastSpace = cut.lastIndexOf(' ');
  return `${(lastSpace > 35 ? cut.slice(0, lastSpace) : cut).trim()}…`;
}

const SEO_TITLE_MAX = 60;
const SEO_DESC_MAX = 160;
const SEO_DESC_MIN = 140;

const seoTitle = trimAtWord(cleanMetaText(siteTitle), SEO_TITLE_MAX);
let seoDescription = trimAtWord(cleanMetaText(description), SEO_DESC_MAX);
if (!noindex && seoDescription.length < SEO_DESC_MIN) {
  seoDescription = trimAtWord(`${seoDescription} Shop genuine vape products online at Vapelink Australia.`, SEO_DESC_MAX);
}

const seoImage = image.startsWith('http') ? image : `https://vapelinks.com.au${image}`;
const seoImageAlt = `${seoTitle} featured image`;

import siteData from '../data/site.json';
import collectionsData from '../data/collections.json';

const navCollections = collectionsData
  .filter((c: any) => c.products_count > 0)
  .sort((a: any, b: any) => b.products_count - a.products_count)
  .slice(0, 12);
---

<!DOCTYPE html>
<html lang="en-AU">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{seoTitle}</title>
  <meta name="description" content={seoDescription} />
  {noindex && <meta name="robots" content="noindex, nofollow" />}
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

  <!-- Open Graph -->
  <meta property="og:title" content={seoTitle} />
  <meta property="og:description" content={seoDescription} />
  <meta property="og:type" content={type} />
  <meta property="og:url" content={currentUrl} />
  <meta property="og:image" content={seoImage} />
  <meta property="og:image:alt" content={seoImageAlt} />
  <meta property="og:site_name" content="Vapelink Australia" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content={seoTitle} />
  <meta name="twitter:description" content={seoDescription} />
  <meta name="twitter:image" content={seoImage} />
  <meta name="twitter:image:alt" content={seoImageAlt} />

  <link rel="canonical" href={currentUrl} />
  <meta name="generator" content={Astro.generator} />

  <!-- Geo & Locale -->
  <meta name="geo.region" content="AU-VIC" />
  <meta name="geo.country" content="AU" />
  <meta name="geo.placename" content="Melbourne" />
  <meta name="geo.position" content="-37.7749;144.9632" />
  <meta name="ICBM" content="-37.7749, 144.9632" />
  <meta property="og:locale" content="en_AU" />

  <!-- Sitewide Organization & WebSite Schema -->
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "Organization",
        "@id": "https://vapelinks.com.au/#organization",
        "name": "Vapelink Australia",
        "url": "https://vapelinks.com.au",
        "logo": {
          "@type": "ImageObject",
          "url": "https://vapelinks.com.au/images/logo.svg"
        },
        "contactPoint": {
          "@type": "ContactPoint",
          "email": "info@vapelinks.com.au",
          "contactType": "customer service",
          "areaServed": "AU",
          "availableLanguage": "English"
        },
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Coburg North",
          "addressRegion": "VIC",
          "addressCountry": "AU"
        },
        "sameAs": []
      },
      {
        "@type": "WebSite",
        "@id": "https://vapelinks.com.au/#website",
        "url": "https://vapelinks.com.au",
        "name": "Vapelink Australia",
        "publisher": { "@id": "https://vapelinks.com.au/#organization" },
        "inLanguage": "en-AU",
        "potentialAction": {
          "@type": "SearchAction",
          "target": {
            "@type": "EntryPoint",
            "urlTemplate": "https://vapelinks.com.au/search?q={search_term_string}"
          },
          "query-input": "required name=search_term_string"
        }
      }
    ]
  })} />

  <slot name="head" />
</head>
<body>

  <!-- ═══ Age Gate ═══ -->
  <div id="age-gate" style="display:none;position:fixed;inset:0;z-index:99999;align-items:center;justify-content:center;background:rgba(255,255,255,0.97);backdrop-filter:blur(20px);">
    <div style="max-width:400px;width:100%;margin:0 1rem;">
      <div style="background:var(--color-surface);border:1px solid var(--color-border);border-radius:var(--radius-xl);padding:2.5rem;text-align:center;box-shadow:var(--shadow-lg);">
        <div style="width:56px;height:56px;margin:0 auto 1.25rem;border-radius:var(--radius-lg);background:var(--color-accent-soft);display:flex;align-items:center;justify-content:center;">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--color-accent)" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
        </div>
        <h2 class="font-display" style="font-size:1.2rem;font-weight:700;color:var(--color-text);margin-bottom:0.4rem;">Age Verification</h2>
        <p style="color:var(--color-text-secondary);font-size:0.88rem;line-height:1.6;margin-bottom:1.75rem;">
          You must be <strong style="color:var(--color-text)">18 years or older</strong> to access this website.
        </p>
        <div style="display:flex;gap:0.6rem;justify-content:center;">
          <button id="age-yes" class="btn-primary cursor-pointer" style="padding:0.75rem 2.25rem;font-size:0.95rem;">I'm 18+</button>
          <button id="age-no" class="btn-secondary cursor-pointer" style="padding:0.75rem 2.25rem;font-size:0.95rem;">Exit</button>
        </div>
        <p style="color:var(--color-text-muted);font-size:0.72rem;margin-top:1.25rem;line-height:1.5;">
          By entering, you agree you are of legal age to purchase nicotine products in your jurisdiction.
        </p>
      </div>
    </div>
  </div>

  <!-- ═══ Announcement Bar ═══ -->
  <div class="announcement-bar" id="announcement-bar">
    <div class="announcement-track">
      <div class="announcement-inner" id="announcement-inner">
        <span class="announcement-item">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
          Standard & Express shipping Australia-wide
        </span>
        <span class="announcement-sep">·</span>
        <span class="announcement-item">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
          18+ only — Age verification required
        </span>
        <span class="announcement-sep">·</span>
        <span class="announcement-item">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>
          Melbourne, VIC — Australia-wide shipping
        </span>
        <span class="announcement-sep">·</span>
        <span class="announcement-item">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></svg>
          Australia's favourite vape shop
        </span>
        <span class="announcement-sep">·</span>
        <span class="announcement-item">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
          Standard & Express shipping Australia-wide
        </span>
        <span class="announcement-sep">·</span>
        <span class="announcement-item">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
          18+ only — Age verification required
        </span>
        <span class="announcement-sep">·</span>
        <span class="announcement-item">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>
          Melbourne, VIC — Australia-wide shipping
        </span>
        <span class="announcement-sep">·</span>
        <span class="announcement-item">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></svg>
          Australia's favourite vape shop
        </span>
        <span class="announcement-sep">·</span>
      </div>
    </div>
  </div>

  <!-- ═══ Header ═══ -->
  <header id="site-header" class="site-header">
    <div class="header-container">

      <!-- Logo -->
      <a href="/" class="logo-link" aria-label="Vapelink Australia — Home">
        <img src="/images/logo.svg" alt="Vapelink Australia" class="logo-img" loading="eager" />
      </a>

      <!-- Desktop Nav -->
      <nav class="desktop-nav" aria-label="Main navigation">
        <a href="/" class="nav-link">Home</a>
        <a href="/collections/shop" class="nav-link">Shop</a>

        <!-- Collections Mega Menu -->
        <div class="mega-wrap" id="mega-wrap">
          <button class="nav-link mega-trigger" id="mega-trigger" aria-haspopup="true" aria-expanded="false">
            Collections
            <svg class="mega-chevron" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M6 9l6 6 6-6"/></svg>
          </button>
          <div class="mega-menu" id="mega-menu" role="menu">
            <div class="mega-menu-inner">
              <div class="mega-grid">
                {navCollections.map((c: any) => (
                  <a href={`/collections/${c.handle}`} class="mega-item" role="menuitem">
                    <span class="mega-item-name">{c.title}</span>
                    <span class="mega-item-count">{c.products_count}</span>
                  </a>
                ))}
              </div>
              <div class="mega-footer">
                <a href="/collections" class="mega-all-link">
                  Browse all collections
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                </a>
              </div>
            </div>
          </div>
        </div>

        <a href="/blog" class="nav-link">Blog</a>
        <a href="/about" class="nav-link">About</a>
        <a href="/contact" class="nav-link">Contact</a>
      </nav>

      <!-- Header Actions -->
      <div class="header-actions">
        <!-- Search -->
        <button id="search-toggle" class="hdr-btn" aria-label="Open search">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
        </button>

        <!-- Cart -->
        <button id="cart-toggle" class="hdr-btn hdr-cart-btn" aria-label="Open cart">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
          <span id="cart-count" class="cart-badge" style="display:none;">0</span>
        </button>

        <!-- Mobile Hamburger -->
        <button id="mobile-menu-btn" class="hdr-btn hdr-menu-btn" aria-label="Open menu" aria-expanded="false">
          <span class="hamburger-line"></span>
          <span class="hamburger-line"></span>
          <span class="hamburger-line"></span>
        </button>
      </div>

    </div>

    <!-- Search Slide-Down Bar -->
    <div id="search-bar" class="search-bar" aria-hidden="true">
      <form action="/search" method="get" class="search-bar-form">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
        <input id="search-bar-input" type="text" name="q" placeholder="Search products, brands, collections…" class="search-bar-input" autocomplete="off" spellcheck="false" />
        <button type="button" id="search-close" class="search-bar-close" aria-label="Close search">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        </button>
      </form>
    </div>
  </header>

  <!-- ═══ Mobile Nav Overlay ═══ -->
  <div id="mobile-overlay" class="mobile-overlay" aria-hidden="true"></div>
  <aside id="mobile-menu" class="mobile-drawer" aria-label="Mobile navigation" aria-hidden="true">
    <div class="mobile-drawer-head">
      <a href="/" class="logo-link">
        <img src="/images/logo.svg" alt="Vapelink Australia" style="height:36px;" />
      </a>
      <button id="mobile-close" class="hdr-btn" aria-label="Close menu">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
      </button>
    </div>
    <nav class="mobile-nav-list">
      <a href="/" class="mobile-nav-item">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        Home
      </a>
      <a href="/collections/shop" class="mobile-nav-item">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
        Shop All
      </a>
      <!-- Mobile Collections Accordion -->
      <div class="mobile-accordion">
        <button class="mobile-nav-item mobile-accordion-trigger" id="mobile-collections-btn" aria-expanded="false">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="7" height="7"/><rect x="15" y="3" width="7" height="7"/><rect x="15" y="14" width="7" height="7"/><rect x="2" y="14" width="7" height="7"/></svg>
          Collections
          <svg class="accordion-chevron" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M6 9l6 6 6-6"/></svg>
        </button>
        <div class="mobile-accordion-panel" id="mobile-collections-panel">
          {navCollections.map((c: any) => (
            <a href={`/collections/${c.handle}`} class="mobile-sub-item">
              {c.title}
              <span class="mobile-sub-count">{c.products_count}</span>
            </a>
          ))}
          <a href="/collections" class="mobile-sub-item mobile-sub-all">All collections →</a>
        </div>
      </div>
      <a href="/blog" class="mobile-nav-item">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>
        Blog
      </a>
      <a href="/about" class="mobile-nav-item">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
        About
      </a>
      <a href="/contact" class="mobile-nav-item">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07A19.5 19.5 0 0 1 4.69 12 19.79 19.79 0 0 1 1.53 3.47 2 2 0 0 1 3.5 1.26h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L7.91 8.34a16 16 0 0 0 6.29 6.29l.38-.38a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 21.28 16.92z"/></svg>
        Contact
      </a>
    </nav>
    <div class="mobile-drawer-foot">
      <a href="/account/orders" class="mobile-foot-link">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14"/><path d="m7.5 4.27 9 5.15"/><polyline points="3.29 7 12 12 20.71 7"/><line x1="12" y1="22" x2="12" y2="12"/><circle cx="18.5" cy="15.5" r="2.5"/><path d="M20.27 17.27 22 19"/></svg>
        Track My Orders
      </a>
      <p class="mobile-legal">18+ only. Products contain nicotine, an addictive substance.</p>
    </div>
  </aside>

  <!-- Search overlay hidden — search bar now in header -->

  <!-- Main -->
  <main>
    <slot />
  </main>

  <!-- ═══ Cart Drawer ═══ -->
  <div id="cart-overlay" class="cart-overlay" style="display:none;"></div>
  <aside id="cart-drawer" class="cart-drawer" style="transform:translateX(100%);">
    <div class="cart-drawer-header">
      <h2 class="font-display" style="font-size:1.1rem;font-weight:700;color:var(--color-text);">Your Cart</h2>
      <button id="cart-close" class="cart-close-btn" aria-label="Close cart">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
      </button>
    </div>
    <div id="cart-items" class="cart-items"></div>
    <div id="cart-footer" class="cart-footer" style="display:none;">
      <!-- Minimum Order Warning -->
      <div id="drawer-min-order-banner" class="drawer-min-order-banner" style="display:none;">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#D97706" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 8v4"/><path d="M12 16h.01"/></svg>
        <div>
          <strong style="font-size:0.78rem;color:#92400E;">Minimum order: $300.00 AUD</strong>
          <p id="drawer-min-order-msg" style="font-size:0.72rem;color:#A16207;margin:0.1rem 0 0;">Add <span id="drawer-min-remaining" style="font-weight:700;color:#92400E;">$300.00</span> more to checkout.</p>
        </div>
      </div>
      <!-- Min order progress -->
      <div id="drawer-min-progress" style="display:none;margin-bottom:0.75rem;">
        <div style="width:100%;height:6px;background:var(--color-surface-alt);border-radius:3px;overflow:hidden;border:1px solid var(--color-border);">
          <div id="drawer-min-fill" style="height:100%;background:linear-gradient(90deg,#F59E0B,#16A34A);border-radius:3px;transition:width 0.4s ease;width:0%;"></div>
        </div>
      </div>

      <div class="cart-total-row">
        <span style="font-weight:600;color:var(--color-text);">Total</span>
        <span id="cart-total" class="font-display" style="font-size:1.15rem;font-weight:700;color:var(--color-text);">$0.00 AUD</span>
      </div>
      <a href="/checkout" class="btn-primary" id="cart-checkout-btn" style="width:100%;padding:0.85rem;justify-content:center;font-size:0.95rem;">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
        Checkout
      </a>
      <a href="/cart" class="btn-secondary" style="width:100%;padding:0.75rem;justify-content:center;font-size:0.88rem;margin-top:0.5rem;text-decoration:none;">
        View Cart
      </a>
      <button id="cart-continue" class="btn-secondary" style="width:100%;padding:0.75rem;justify-content:center;font-size:0.88rem;margin-top:0.5rem;">
        Continue Shopping
      </button>
      <button id="cart-clear" class="cart-clear-link">
        Clear Cart
      </button>
    </div>
    <div id="cart-empty" class="cart-empty">
      <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="var(--color-text-dim)" stroke-width="1.5"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
      <p style="color:var(--color-text-secondary);font-size:0.9rem;margin-top:0.75rem;">Your cart is empty</p>
      <a href="/collections/shop" class="btn-secondary" style="margin-top:1rem;padding:0.55rem 1.5rem;font-size:0.82rem;">Browse Products</a>
    </div>
  </aside>

  <!-- ═══ Footer ═══ -->
  <footer class="site-footer">
    <div class="container footer-inner">
      <div class="footer-grid">
        <div>
          <img src="/images/logo.svg" alt="Vapelink Australia" style="height:42px;margin-bottom:1rem;" />
          <p class="footer-desc">{siteData.description.substring(0, 180)}</p>
        </div>
        <div>
          <h3 class="font-display footer-heading">Quick Links</h3>
          <ul class="footer-links">
            <li><a href="/collections/shop">Shop All</a></li>
            <li><a href="/collections/all-vape-kits">Vape Kits</a></li>
            <li><a href="/collections/all-accessories">Accessories</a></li>
            <li><a href="/collections/all-clearance">Clearance</a></li>
          </ul>
        </div>
        <div>
          <h3 class="font-display footer-heading">Information</h3>
          <ul class="footer-links">
            <li><a href="/about">About Us</a></li>
            <li><a href="/contact">Contact Us</a></li>
            <li><a href="/pages/shipping-policy">Shipping Policy</a></li>
            <li><a href="/pages/refund-policy">Refund Policy</a></li>
            <li><a href="/pages/privacy-policy">Privacy Policy</a></li>
            <li><a href="/pages/terms-conditions">Terms & Conditions</a></li>
            <li><a href="/pages/cookies-policy">Cookies Policy</a></li>
            <li><a href="/faq">FAQ</a></li>
          </ul>
        </div>
        <div>
          <h3 class="font-display footer-heading">Get in Touch</h3>
          <div class="footer-contact">
            <a href="mailto:info@vapelinks.com.au" class="contact-item">
              <span class="contact-icon">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="var(--color-accent)" stroke-width="2"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
              </span>
              {siteData.contact_email}
            </a>
            <div class="contact-item">
              <span class="contact-icon">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="var(--color-accent)" stroke-width="2"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>
              </span>
              Melbourne, VIC, Australia
            </div>
          </div>
        </div>
      </div>

      <!-- Legal disclaimer -->
      <div class="footer-legal">
        <p>WARNING: This product contains nicotine. Nicotine is an addictive chemical. Products sold on this site are intended for adults of legal smoking age only (18+). By using this website, you agree to our <a href="/pages/terms-conditions" style="text-decoration:underline;">Terms & Conditions</a> and <a href="/pages/privacy-policy" style="text-decoration:underline;">Privacy Policy</a>.</p>
      </div>

      <div class="footer-bottom">
        <p>&copy; {new Date().getFullYear()} Vapelink Australia. All rights reserved.</p>
        <div class="footer-pay-badges">
          <span class="pay-badge">
            <svg class="pay-icon" width="18" height="18" viewBox="0 0 64 64" fill="none"><rect x="4" y="54" width="56" height="4" rx="1" fill="currentColor" opacity="0.7"/><rect x="4" y="24" width="56" height="5" rx="1" fill="currentColor" opacity="0.5"/><path d="M32 4L4 24h56L32 4z" fill="currentColor" opacity="0.5"/><rect x="10" y="29" width="5" height="25" rx="1" fill="currentColor" opacity="0.3"/><rect x="22" y="29" width="5" height="25" rx="1" fill="currentColor" opacity="0.3"/><rect x="37" y="29" width="5" height="25" rx="1" fill="currentColor" opacity="0.3"/><rect x="49" y="29" width="5" height="25" rx="1" fill="currentColor" opacity="0.3"/></svg>
            Bank Transfer
          </span>
          <span class="pay-badge">
            <svg class="pay-icon" width="18" height="18" viewBox="0 0 64 64" fill="none"><rect width="64" height="64" rx="12" fill="#00B2A9" opacity="0.15"/><text x="32" y="40" font-family="Arial,Helvetica,sans-serif" font-weight="800" font-size="24" fill="#00B2A9" text-anchor="middle" letter-spacing="-1">PAY</text><circle cx="50" cy="20" r="4" fill="#00B2A9"/><rect x="48" y="24" width="4" height="14" rx="2" fill="#00B2A9"/></svg>
            PayID
          </span>
          <span class="pay-badge">
            <svg class="pay-icon" width="18" height="18" viewBox="0 0 64 64" fill="none"><circle cx="32" cy="32" r="32" fill="#F7931A"/><path d="M46.1 27.4c.6-4.2-2.6-6.5-7-8l1.4-5.7-3.5-.9-1.4 5.5c-.9-.2-1.9-.4-2.8-.7l1.4-5.5-3.5-.9-1.4 5.7c-.8-.2-1.5-.3-2.2-.5l0 0-4.8-1.2-1 3.7s2.6.6 2.5.6c1.4.4 1.7 1.3 1.6 2l-1.6 6.5c.1 0 .2.1.3.1l-.3-.1-2.3 9.1c-.2.4-.6 1.1-1.6.8 0 0-2.5-.6-2.5-.6l-1.7 4 4.5 1.1c.8.2 1.7.4 2.5.6l-1.5 5.8 3.5.9 1.4-5.7c1 .3 1.9.5 2.8.7l-1.4 5.7 3.5.9 1.5-5.8c5.8 1.1 10.2.7 12-4.6 1.5-4.2-.1-6.7-3.2-8.3 2.2-.5 3.9-2 4.4-5.1zM39.5 38.2c-1.1 4.2-8.2 1.9-10.5 1.4l1.9-7.5c2.3.6 9.7 1.7 8.6 6.1zm1-10.9c-1 3.9-6.9 1.9-8.8 1.4l1.7-6.8c2 .5 8.2 1.4 7.1 5.4z" fill="white"/></svg>
            Bitcoin
          </span>
        </div>
        <div class="footer-bottom-links">
          <a href="/pages/privacy-policy">Privacy</a>
          <a href="/pages/terms-conditions">Terms</a>
          <a href="/pages/refund-policy">Refunds</a>
          <a href="/pages/shipping-policy">Shipping</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- ═══ Cookie Consent Banner ═══ -->
  <div id="cookie-consent" class="cookie-consent" style="display:none;">
    <div class="cookie-consent-inner">
      <div class="cookie-consent-text">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-accent)" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
        <p>We use cookies to improve your experience, keep your cart working, and analyse site traffic. By continuing to browse, you agree to our use of cookies. <a href="/pages/cookies-policy" style="color:var(--color-accent);text-decoration:underline;font-weight:600;">Cookies Policy</a></p>
      </div>
      <div class="cookie-consent-actions">
        <button id="cookie-accept" class="btn-primary" style="padding:0.55rem 1.5rem;font-size:0.82rem;white-space:nowrap;">Accept All</button>
        <button id="cookie-dismiss" class="btn-secondary" style="padding:0.55rem 1rem;font-size:0.82rem;white-space:nowrap;">Dismiss</button>
      </div>
    </div>
  </div>

  <style is:global>
    /* ═══════════════════════════════════════
       ANNOUNCEMENT BAR
    ═══════════════════════════════════════ */
    .announcement-bar {
      background: #0a0f1e;
      color: rgba(255,255,255,0.72);
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      overflow: hidden;
      height: 34px;
      display: flex;
      align-items: center;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .announcement-track {
      overflow: hidden;
      flex: 1;
    }
    .announcement-inner {
      display: inline-flex;
      align-items: center;
      white-space: nowrap;
      gap: 0;
      animation: ticker 36s linear infinite;
    }
    .announcement-inner:hover { animation-play-state: paused; }
    .announcement-item {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0 2rem;
    }
    .announcement-item svg { opacity: 0.55; color: #22c55e; flex-shrink: 0; }
    .announcement-sep {
      color: rgba(255,255,255,0.2);
      font-size: 1em;
      padding: 0 0.25rem;
    }
    @keyframes ticker {
      0%   { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }

    /* ═══════════════════════════════════════
       SITE HEADER
    ═══════════════════════════════════════ */
    .site-header {
      position: sticky;
      top: 0;
      z-index: 200;
      background: rgba(255,255,255,0.96);
      backdrop-filter: saturate(180%) blur(20px);
      -webkit-backdrop-filter: saturate(180%) blur(20px);
      border-bottom: 1px solid #E8EDF5;
      transition: box-shadow 0.3s ease, border-color 0.3s ease;
    }
    .site-header.scrolled {
      box-shadow: 0 4px 24px rgba(10, 15, 30, 0.07), 0 1px 4px rgba(10, 15, 30, 0.04);
      border-color: #D8E0EC;
    }
    .header-container {
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 1.5rem;
      height: 68px;
      display: flex;
      align-items: center;
      gap: 2rem;
    }
    @media (min-width: 1200px) {
      .header-container { padding: 0 2.5rem; }
    }

    /* ── Logo ── */
    .logo-link {
      display: flex;
      align-items: center;
      text-decoration: none;
      flex-shrink: 0;
    }
    .logo-img {
      height: 42px;
      width: auto;
      filter: saturate(1.1);
    }

    /* ═══════════════════════════════════════
       DESKTOP NAVIGATION
    ═══════════════════════════════════════ */
    .desktop-nav {
      display: none;
      align-items: center;
      gap: 0.15rem;
      flex: 1;
    }
    @media (min-width: 1024px) {
      .desktop-nav { display: flex; }
    }

    .nav-link {
      position: relative;
      color: #3D4E66;
      font-size: 0.83rem;
      font-weight: 600;
      font-family: var(--font-display);
      letter-spacing: 0.005em;
      text-decoration: none;
      padding: 0.4rem 0.7rem;
      border-radius: 8px;
      border: none;
      background: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.3rem;
      transition: color 0.15s ease, background 0.15s ease;
      white-space: nowrap;
    }
    .nav-link::after {
      content: '';
      position: absolute;
      bottom: 2px;
      left: 0.7rem;
      right: 0.7rem;
      height: 2px;
      background: var(--color-accent);
      border-radius: 2px;
      transform: scaleX(0);
      transform-origin: center;
      transition: transform 0.2s var(--ease-out);
    }
    .nav-link:hover {
      color: #0D1526;
      background: #F3F6FB;
    }
    .nav-link:hover::after { transform: scaleX(1); }
    .nav-link.active {
      color: var(--color-accent);
    }
    .nav-link.active::after { transform: scaleX(1); }

    /* ── Mega Menu ── */
    .mega-wrap {
      position: static;
    }
    .mega-trigger {
      /* inherits .nav-link */
    }
    .mega-chevron {
      transition: transform 0.25s var(--ease-out);
      flex-shrink: 0;
    }
    .mega-wrap.open .mega-chevron,
    .mega-trigger[aria-expanded="true"] .mega-chevron {
      transform: rotate(180deg);
    }

    .mega-menu {
      position: absolute;
      left: 0;
      right: 0;
      top: 100%;
      background: #fff;
      border-top: 1px solid #E8EDF5;
      border-bottom: 1px solid #E8EDF5;
      box-shadow: 0 24px 64px rgba(10, 15, 30, 0.10), 0 4px 16px rgba(10, 15, 30, 0.05);
      z-index: 300;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-8px);
      transition: opacity 0.22s var(--ease-out),
                  visibility 0.22s var(--ease-out),
                  transform 0.22s var(--ease-out);
      pointer-events: none;
    }
    .mega-menu.open {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
      pointer-events: auto;
    }
    .mega-menu-inner {
      max-width: 1280px;
      margin: 0 auto;
      padding: 1.75rem 2.5rem 1.25rem;
    }
    .mega-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(190px, 1fr));
      gap: 0.25rem;
    }
    .mega-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.5rem 0.7rem;
      border-radius: 8px;
      text-decoration: none;
      transition: background 0.13s ease, color 0.13s ease;
    }
    .mega-item:hover {
      background: #F3F6FB;
    }
    .mega-item-name {
      font-size: 0.8rem;
      font-weight: 500;
      color: #344156;
      transition: color 0.13s ease;
    }
    .mega-item:hover .mega-item-name { color: #0D1526; }
    .mega-item-count {
      font-size: 0.67rem;
      font-weight: 600;
      color: #16a34a;
      background: rgba(22,163,74,0.08);
      padding: 0.1rem 0.45rem;
      border-radius: 99px;
      flex-shrink: 0;
      margin-left: 0.5rem;
      letter-spacing: 0.01em;
    }
    .mega-footer {
      margin-top: 1rem;
      padding-top: 0.9rem;
      border-top: 1px solid #EEF2F8;
    }
    .mega-all-link {
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
      font-size: 0.8rem;
      font-weight: 700;
      font-family: var(--font-display);
      color: var(--color-accent);
      text-decoration: none;
      letter-spacing: 0.01em;
      transition: gap 0.2s ease;
      padding: 0.1rem 0;
    }
    .mega-all-link:hover { gap: 0.7rem; }

    /* ═══════════════════════════════════════
       HEADER ACTIONS (icons)
    ═══════════════════════════════════════ */
    .header-actions {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      margin-left: auto;
      flex-shrink: 0;
    }
    .hdr-btn {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 38px;
      height: 38px;
      border-radius: 10px;
      border: none;
      background: transparent;
      color: #4A5A72;
      cursor: pointer;
      transition: background 0.15s ease, color 0.15s ease;
    }
    .hdr-btn:hover {
      background: #F0F4FB;
      color: #0D1526;
    }
    .hdr-menu-btn {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 4.5px;
      width: 38px;
      height: 38px;
    }
    @media (min-width: 1024px) {
      .hdr-menu-btn { display: none !important; }
    }
    .hamburger-line {
      display: block;
      width: 18px;
      height: 1.5px;
      background: currentColor;
      border-radius: 2px;
      transition: transform 0.25s var(--ease-out), opacity 0.2s ease, width 0.2s ease;
      transform-origin: center;
    }
    .menu-open .hamburger-line:nth-child(1) { transform: translateY(6px) rotate(45deg); }
    .menu-open .hamburger-line:nth-child(2) { opacity: 0; transform: scaleX(0); }
    .menu-open .hamburger-line:nth-child(3) { transform: translateY(-6px) rotate(-45deg); }

    .cart-badge {
      position: absolute;
      top: 4px;
      right: 4px;
      background: var(--color-accent);
      color: #fff;
      font-size: 0.58rem;
      font-weight: 700;
      font-family: var(--font-display);
      min-width: 15px;
      height: 15px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 3px;
      line-height: 1;
      border: 1.5px solid #fff;
    }

    /* ═══════════════════════════════════════
       SEARCH SLIDE-DOWN BAR
    ═══════════════════════════════════════ */
    .search-bar {
      border-top: 1px solid #E8EDF5;
      background: #fff;
      overflow: hidden;
      max-height: 0;
      opacity: 0;
      transition: max-height 0.3s var(--ease-out), opacity 0.25s ease;
    }
    .search-bar.open {
      max-height: 80px;
      opacity: 1;
    }
    .search-bar-form {
      max-width: 680px;
      margin: 0 auto;
      padding: 0.75rem 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    .search-bar-form svg:first-child { color: #7A8DA8; flex-shrink: 0; }
    .search-bar-input {
      flex: 1;
      border: none;
      background: none;
      font-size: 0.95rem;
      color: #0D1526;
      outline: none;
      font-family: var(--font-body);
    }
    .search-bar-input::placeholder { color: #9DAEC4; }
    .search-bar-close {
      background: none;
      border: none;
      color: #9DAEC4;
      cursor: pointer;
      padding: 0.2rem;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color 0.15s ease, background 0.15s ease;
      flex-shrink: 0;
    }
    .search-bar-close:hover { color: #0D1526; background: #F0F4FB; }

    /* ═══════════════════════════════════════
       MOBILE DRAWER
    ═══════════════════════════════════════ */
    .mobile-overlay {
      position: fixed;
      inset: 0;
      background: rgba(10, 15, 30, 0.4);
      backdrop-filter: blur(4px);
      z-index: 298;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }
    .mobile-overlay.open {
      opacity: 1;
      pointer-events: auto;
    }
    .mobile-drawer {
      position: fixed;
      top: 0;
      left: 0;
      width: min(340px, 88vw);
      height: 100dvh;
      background: #fff;
      z-index: 299;
      display: flex;
      flex-direction: column;
      transform: translateX(-100%);
      transition: transform 0.32s var(--ease-out);
      border-right: 1px solid #E8EDF5;
      box-shadow: 8px 0 48px rgba(10, 15, 30, 0.15);
    }
    .mobile-drawer.open {
      transform: translateX(0);
    }
    @media (min-width: 1024px) {
      .mobile-overlay, .mobile-drawer { display: none !important; }
    }
    .mobile-drawer-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1.25rem;
      border-bottom: 1px solid #EEF2F8;
      flex-shrink: 0;
    }
    .mobile-nav-list {
      flex: 1;
      overflow-y: auto;
      padding: 0.75rem 0.75rem;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .mobile-nav-item {
      display: flex;
      align-items: center;
      gap: 0.7rem;
      padding: 0.7rem 0.85rem;
      font-size: 0.88rem;
      font-weight: 600;
      font-family: var(--font-display);
      color: #2D3A4F;
      text-decoration: none;
      border-radius: 10px;
      transition: background 0.13s ease, color 0.13s ease;
      border: none;
      background: none;
      cursor: pointer;
      width: 100%;
      text-align: left;
    }
    .mobile-nav-item:hover {
      background: #F3F6FB;
      color: #0D1526;
    }
    .mobile-nav-item svg { flex-shrink: 0; color: #7A8DA8; }
    .mobile-nav-item:hover svg { color: var(--color-accent); }

    /* Accordion */
    .mobile-accordion { display: flex; flex-direction: column; gap: 2px; }
    .mobile-accordion-trigger {
      width: 100%;
      justify-content: flex-start;
    }
    .accordion-chevron {
      margin-left: auto;
      transition: transform 0.25s var(--ease-out);
      flex-shrink: 0;
    }
    .mobile-accordion-trigger[aria-expanded="true"] .accordion-chevron {
      transform: rotate(180deg);
    }
    .mobile-accordion-panel {
      display: none;
      flex-direction: column;
      gap: 1px;
      padding: 0 0 0.35rem 0;
    }
    .mobile-accordion-panel.open { display: flex; }
    .mobile-sub-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.5rem 0.85rem 0.5rem 2.8rem;
      font-size: 0.82rem;
      font-weight: 500;
      color: #4A5A72;
      text-decoration: none;
      border-radius: 8px;
      transition: background 0.13s ease, color 0.13s ease;
    }
    .mobile-sub-item:hover {
      background: #F3F6FB;
      color: #0D1526;
    }
    .mobile-sub-count {
      font-size: 0.65rem;
      font-weight: 600;
      color: #16a34a;
      background: rgba(22,163,74,0.09);
      padding: 0.08rem 0.4rem;
      border-radius: 99px;
      flex-shrink: 0;
    }
    .mobile-sub-all {
      font-weight: 700;
      color: var(--color-accent);
      font-family: var(--font-display);
    }
    .mobile-sub-all:hover { background: rgba(22,163,74,0.06); }

    .mobile-drawer-foot {
      padding: 1rem 1.5rem 1.5rem;
      border-top: 1px solid #EEF2F8;
      background: #FAFBFC;
      flex-shrink: 0;
    }
    .mobile-foot-link {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--color-accent);
      text-decoration: none;
      transition: opacity 0.15s ease;
    }
    .mobile-foot-link:hover { opacity: 0.75; }
    .mobile-legal {
      font-size: 0.65rem;
      color: #9DAEC4;
      line-height: 1.5;
      margin-top: 0.75rem;
    }

    /* ── Cart Clear Link ── */
    .cart-clear-link {
      display: block;
      width: 100%;
      text-align: center;
      background: none;
      border: none;
      color: var(--color-text-muted);
      font-size: 0.78rem;
      cursor: pointer;
      padding: 0.65rem 0 0.25rem;
      transition: color 0.15s ease;
      font-family: var(--font-body);
    }
    .cart-clear-link:hover { color: var(--color-sale); }

    /* Min Order Banner in Drawer */
    .drawer-min-order-banner {
      display: flex;
      gap: 0.6rem;
      padding: 0.75rem 0.85rem;
      background: #FEF3C7;
      border: 1px solid #F59E0B;
      border-radius: var(--radius-md);
      margin-bottom: 0.75rem;
      align-items: flex-start;
    }

    /* ── Footer ── */
    .site-footer {
      background: linear-gradient(180deg, #ffffff, #f0fdf4);
      border-top: 1px solid var(--color-border);
      margin-top: var(--space-3xl);
    }
    .footer-inner {
      padding-top: 3.5rem;
      padding-bottom: 2rem;
    }
    .footer-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 2.5rem;
    }
    @media (min-width: 768px) {
      .footer-grid { grid-template-columns: 1.5fr 1fr 1fr 1.2fr; }
    }
    .footer-desc {
      color: var(--color-text-secondary);
      font-size: 0.85rem;
      line-height: 1.7;
      max-width: 280px;
    }
    .footer-heading {
      color: var(--color-text);
      font-size: 0.75rem;
      font-weight: 700;
      letter-spacing: 0.11em;
      text-transform: uppercase;
      margin-bottom: 1.1rem;
    }
    .footer-links {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 0.55rem;
    }
    .footer-links a {
      color: var(--color-text-secondary);
      text-decoration: none;
      font-size: 0.85rem;
      transition: color 0.15s ease;
    }
    .footer-links a:hover { color: var(--color-accent); }
    .footer-contact {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    .contact-item {
      display: flex;
      align-items: center;
      gap: 0.55rem;
      color: var(--color-text-secondary);
      text-decoration: none;
      font-size: 0.85rem;
      transition: color 0.15s ease;
    }
    a.contact-item:hover { color: var(--color-accent); }
    .contact-icon {
      width: 30px;
      height: 30px;
      border-radius: 10px;
      background: var(--color-accent-soft);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    /* Legal */
    .footer-legal {
      margin-top: 2.5rem;
      padding: 1rem 1.25rem;
      background: #f0fdf4;
      border-radius: var(--radius-md);
      border: 1px solid var(--color-border);
    }
    .footer-legal p {
      font-size: 0.72rem;
      color: var(--color-text-muted);
      line-height: 1.6;
    }

    .footer-bottom {
      border-top: 1px solid var(--color-border);
      margin-top: 2rem;
      padding-top: 1.25rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 0.75rem;
    }
    .footer-bottom p {
      color: var(--color-text-muted);
      font-size: 0.75rem;
    }
    .footer-pay-badges {
      display: flex;
      align-items: center;
      gap: 0.45rem;
      flex-wrap: wrap;
    }
    .pay-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.3rem 0.7rem;
      font-size: 0.68rem;
      font-family: var(--font-display);
      font-weight: 700;
      color: var(--color-text-secondary);
      background: var(--color-surface-alt);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-full);
      letter-spacing: 0.02em;
      transition: border-color 0.15s, background 0.15s;
    }
    .pay-badge:hover {
      border-color: var(--color-border-hover);
      background: var(--color-surface);
    }
    .pay-icon {
      flex-shrink: 0;
      color: var(--color-text-muted);
    }
    .pay-icon-btc { color: #f7931a; }
    .footer-bottom-links {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }
    .footer-bottom-links a {
      color: var(--color-text-muted);
      text-decoration: none;
      font-size: 0.75rem;
      transition: color 0.15s ease;
    }
    .footer-bottom-links a:hover { color: var(--color-text-secondary); }
    @media (max-width: 640px) {
      .footer-bottom { flex-direction: column; align-items: center; text-align: center; }
      .footer-bottom-links { justify-content: center; }
      .footer-pay-badges { justify-content: center; }
    }

    /* ── Cart Drawer ── */
    .cart-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.32);
      z-index: 998;
      cursor: pointer;
      transition: opacity 0.25s ease;
    }
    .cart-drawer {
      position: fixed;
      top: 0;
      right: 0;
      width: 100%;
      max-width: 400px;
      height: 100vh;
      height: 100dvh;
      background: var(--color-surface);
      border-left: 1px solid var(--color-border);
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.04), -18px 0 48px rgba(15, 23, 42, 0.18);
      z-index: 999;
      display: flex;
      flex-direction: column;
      transition: transform 0.3s var(--ease-out);
    }
    .cart-drawer-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1.25rem 1.5rem;
      border-bottom: 1px solid var(--color-border);
      flex-shrink: 0;
    }
    .cart-close-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      border-radius: var(--radius-sm);
      background: none;
      border: 1px solid var(--color-border);
      color: var(--color-text-secondary);
      cursor: pointer;
      transition: all 0.15s ease;
    }
    .cart-close-btn:hover {
      color: var(--color-text);
      border-color: var(--color-border-hover);
      background: var(--color-surface-alt);
    }
    .cart-items {
      flex: 1;
      overflow-y: auto;
      padding: 1rem 1.5rem;
    }
    .cart-item {
      display: flex;
      gap: 0.85rem;
      padding: 0.85rem 0;
      border-bottom: 1px solid var(--color-border);
    }
    .cart-item:last-child { border-bottom: none; }
    .cart-item-img {
      width: 68px;
      height: 68px;
      object-fit: contain;
      border-radius: var(--radius-md);
      border: 1px solid var(--color-border);
      background: linear-gradient(135deg, var(--color-surface-alt), #F0FDF4);
      flex-shrink: 0;
    }
    .cart-item-info { flex: 1; min-width: 0; }
    .cart-item-title {
      font-size: 0.82rem;
      font-weight: 600;
      color: var(--color-text);
      line-height: 1.3;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      margin-bottom: 0.25rem;
    }
    .cart-item-price {
      font-family: var(--font-display);
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--color-text);
    }
    .cart-item-qty {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-top: 0.4rem;
    }
    .cart-qty-btn {
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--color-surface-alt);
      border: 1.5px solid var(--color-border);
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-size: 0.85rem;
      font-weight: 700;
      color: var(--color-text-secondary);
      font-family: var(--font-display);
      transition: all 0.15s ease;
    }
    .cart-qty-btn:hover {
      background: var(--color-accent-soft);
      border-color: var(--color-accent);
      color: var(--color-accent);
    }
    .cart-qty-val {
      font-family: var(--font-display);
      font-size: 0.82rem;
      font-weight: 600;
      color: var(--color-text);
      min-width: 20px;
      text-align: center;
    }
    .cart-item-remove {
      background: none;
      border: none;
      color: var(--color-text-muted);
      cursor: pointer;
      padding: 0.25rem;
      transition: color 0.15s ease;
      flex-shrink: 0;
      align-self: flex-start;
    }
    .cart-item-remove:hover { color: var(--color-sale); }
    .cart-footer {
      padding: 1.5rem;
      border-top: 1px solid var(--color-border);
      flex-shrink: 0;
      background: linear-gradient(180deg, var(--color-surface) 0%, #F0FDF4 100%);
    }
    .cart-total-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
    }
    .cart-empty {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      text-align: center;
    }

    /* ── Cookie Consent ── */
    .cookie-consent {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 9999;
      background: var(--color-surface);
      border-top: 1px solid var(--color-border);
      box-shadow: 0 -4px 24px rgba(0,0,0,0.1);
      animation: slideUp 0.3s ease;
    }
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    .cookie-consent-inner {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1rem 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1.5rem;
    }
    .cookie-consent-text {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      flex: 1;
    }
    .cookie-consent-text svg { flex-shrink: 0; margin-top: 0.1rem; }
    .cookie-consent-text p {
      font-size: 0.82rem;
      color: var(--color-text-secondary);
      line-height: 1.6;
      margin: 0;
    }
    .cookie-consent-actions {
      display: flex;
      gap: 0.5rem;
      flex-shrink: 0;
    }
    @media (max-width: 640px) {
      .cookie-consent-inner { flex-direction: column; align-items: stretch; gap: 0.85rem; }
      .cookie-consent-actions { justify-content: stretch; }
      .cookie-consent-actions button { flex: 1; }
    }
  </style>

  <script>
    // ── Cookie consent ──
    const cookieBanner = document.getElementById('cookie-consent');
    if (cookieBanner && !localStorage.getItem('cookie_consent')) {
      cookieBanner.style.display = 'block';
    }
    document.getElementById('cookie-accept')?.addEventListener('click', () => {
      localStorage.setItem('cookie_consent', 'accepted');
      if (cookieBanner) cookieBanner.style.display = 'none';
    });
    document.getElementById('cookie-dismiss')?.addEventListener('click', () => {
      localStorage.setItem('cookie_consent', 'dismissed');
      if (cookieBanner) cookieBanner.style.display = 'none';
    });

    // ── Age gate ──
    const ageGate = document.getElementById('age-gate');
    if (ageGate && !localStorage.getItem('age_verified')) {
      ageGate.style.display = 'flex';
    }
    document.getElementById('age-yes')?.addEventListener('click', () => {
      localStorage.setItem('age_verified', 'true');
      if (ageGate) ageGate.style.display = 'none';
    });
    document.getElementById('age-no')?.addEventListener('click', () => {
      window.location.href = 'https://www.google.com';
    });

    // ── Mobile menu ──
    const mobileBtn = document.getElementById('mobile-menu-btn') as HTMLButtonElement | null;
    const mobileMenu = document.getElementById('mobile-menu');
    const mobileOverlay = document.getElementById('mobile-overlay');
    const mobileClose = document.getElementById('mobile-close');

    function openMobileMenu() {
      mobileMenu?.classList.add('open');
      mobileOverlay?.classList.add('open');
      mobileBtn?.classList.add('menu-open');
      mobileBtn?.setAttribute('aria-expanded', 'true');
      mobileMenu?.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';
    }
    function closeMobileMenu() {
      mobileMenu?.classList.remove('open');
      mobileOverlay?.classList.remove('open');
      mobileBtn?.classList.remove('menu-open');
      mobileBtn?.setAttribute('aria-expanded', 'false');
      mobileMenu?.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
    }
    mobileBtn?.addEventListener('click', () => {
      mobileMenu?.classList.contains('open') ? closeMobileMenu() : openMobileMenu();
    });
    mobileClose?.addEventListener('click', closeMobileMenu);
    mobileOverlay?.addEventListener('click', closeMobileMenu);

    // ── Mobile collections accordion ──
    const accBtn = document.getElementById('mobile-collections-btn') as HTMLButtonElement | null;
    const accPanel = document.getElementById('mobile-collections-panel');
    accBtn?.addEventListener('click', () => {
      const isOpen = accPanel?.classList.contains('open');
      accPanel?.classList.toggle('open', !isOpen);
      accBtn.setAttribute('aria-expanded', String(!isOpen));
    });

    // ── Header scroll ──
    const header = document.getElementById('site-header');
    window.addEventListener('scroll', () => {
      header?.classList.toggle('scrolled', window.scrollY > 40);
    }, { passive: true });

    // ── Mega Menu (desktop Collections) ──
    const megaWrap = document.getElementById('mega-wrap');
    const megaMenu = document.getElementById('mega-menu');
    const megaTrigger = document.getElementById('mega-trigger') as HTMLButtonElement | null;
    let megaTimer: ReturnType<typeof setTimeout>;

    function openMega() {
      clearTimeout(megaTimer);
      megaMenu?.classList.add('open');
      megaTrigger?.setAttribute('aria-expanded', 'true');
    }
    function closeMega() {
      megaTimer = setTimeout(() => {
        megaMenu?.classList.remove('open');
        megaTrigger?.setAttribute('aria-expanded', 'false');
      }, 120);
    }
    megaWrap?.addEventListener('mouseenter', openMega);
    megaWrap?.addEventListener('mouseleave', closeMega);
    megaTrigger?.addEventListener('click', () => {
      megaMenu?.classList.contains('open') ? closeMega() : openMega();
    });
    megaMenu?.addEventListener('mouseenter', () => clearTimeout(megaTimer));
    megaMenu?.addEventListener('mouseleave', closeMega);

    // ── Search slide-down bar ──
    const searchBar = document.getElementById('search-bar');
    const searchBarInput = document.getElementById('search-bar-input') as HTMLInputElement | null;
    // keep legacy overlay reference (null) to avoid errors from old JS
    const searchOverlay = null;
    function openSearch() {
      searchBar?.classList.add('open');
      searchBar?.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = '';
      setTimeout(() => searchBarInput?.focus(), 60);
    }
    function closeSearch() {
      searchBar?.classList.remove('open');
      searchBar?.setAttribute('aria-hidden', 'true');
    }
    document.getElementById('search-toggle')?.addEventListener('click', openSearch);
    document.getElementById('search-close')?.addEventListener('click', closeSearch);

    // ── Cart system ──
    function getCart(): any[] {
      try { return JSON.parse(localStorage.getItem('vapelink_cart') || '[]'); } catch { return []; }
    }

    function saveCart(cart: any[]) {
      localStorage.setItem('vapelink_cart', JSON.stringify(cart));
      window.dispatchEvent(new CustomEvent('cart-updated'));
    }

    function updateCartBadges() {
      const cart = getCart();
      const totalQty = cart.reduce((s: number, i: any) => s + (i.qty || 1), 0);
      const el = document.getElementById('cart-count');
      if (el) {
        el.textContent = String(totalQty);
        el.style.display = totalQty > 0 ? 'flex' : 'none';
      }
    }

    // ── Cart Drawer ──
    const cartDrawer = document.getElementById('cart-drawer');
    const cartOverlay = document.getElementById('cart-overlay');
    const cartItemsEl = document.getElementById('cart-items');
    const cartFooterEl = document.getElementById('cart-footer');
    const cartEmptyEl = document.getElementById('cart-empty');
    const cartTotalEl = document.getElementById('cart-total');

    function openCart() {
      if (cartDrawer) cartDrawer.style.transform = 'translateX(0)';
      if (cartOverlay) cartOverlay.style.display = 'block';
      document.body.style.overflow = 'hidden';
      renderCart();
    }

    function closeCart() {
      if (cartDrawer) cartDrawer.style.transform = 'translateX(100%)';
      if (cartOverlay) cartOverlay.style.display = 'none';
      document.body.style.overflow = '';
    }

    function renderCart() {
      const cart = getCart();
      if (!cartItemsEl || !cartFooterEl || !cartEmptyEl) return;

      if (cart.length === 0) {
        cartItemsEl.innerHTML = '';
        cartFooterEl.style.display = 'none';
        cartEmptyEl.style.display = 'flex';
        return;
      }

      cartEmptyEl.style.display = 'none';
      cartFooterEl.style.display = 'block';

      let total = 0;
      cartItemsEl.innerHTML = cart.map((item: any, idx: number) => {
        const itemTotal = parseFloat(item.price || '0') * (item.qty || 1);
        total += itemTotal;
        const imgSrc = item.image || '';
        return `
          <div class="cart-item">
            ${imgSrc ? `<img src="${imgSrc}" alt="${item.title || 'Cart product image'}" class="cart-item-img" onerror="this.style.display='none'"/>` : ''}
            <div class="cart-item-info">
              <a href="/products/${item.handle}" class="cart-item-title" style="text-decoration:none;">${item.title}</a>
              <div class="cart-item-price">$${itemTotal.toFixed(2)} AUD</div>
              <div class="cart-item-qty">
                <button class="cart-qty-btn" data-action="minus" data-idx="${idx}">−</button>
                <span class="cart-qty-val">${item.qty || 1}</span>
                <button class="cart-qty-btn" data-action="plus" data-idx="${idx}">+</button>
              </div>
            </div>
            <button class="cart-item-remove" data-action="remove" data-idx="${idx}" aria-label="Remove">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
            </button>
          </div>
        `;
      }).join('');

      if (cartTotalEl) cartTotalEl.textContent = `$${total.toFixed(2)} AUD`;

      // ── Minimum $300 Order Enforcement (Drawer) ──
      const DRAWER_MIN = 300;
      const drawerRemaining = DRAWER_MIN - total;
      const drawerBanner = document.getElementById('drawer-min-order-banner');
      const drawerRemEl = document.getElementById('drawer-min-remaining');
      const drawerProgress = document.getElementById('drawer-min-progress');
      const drawerFill = document.getElementById('drawer-min-fill');
      const drawerCheckoutBtn = document.getElementById('cart-checkout-btn') as HTMLAnchorElement;

      if (total < DRAWER_MIN) {
        if (drawerBanner) drawerBanner.style.display = 'flex';
        if (drawerRemEl) drawerRemEl.textContent = `$${drawerRemaining.toFixed(2)}`;
        if (drawerProgress) drawerProgress.style.display = 'block';
        if (drawerFill) drawerFill.style.width = `${Math.min((total / DRAWER_MIN) * 100, 100)}%`;
        if (drawerCheckoutBtn) {
          drawerCheckoutBtn.removeAttribute('href');
          drawerCheckoutBtn.style.opacity = '0.5';
          drawerCheckoutBtn.style.pointerEvents = 'none';
          drawerCheckoutBtn.style.cursor = 'not-allowed';
        }
      } else {
        if (drawerBanner) drawerBanner.style.display = 'none';
        if (drawerProgress) drawerProgress.style.display = 'none';
        if (drawerCheckoutBtn) {
          drawerCheckoutBtn.setAttribute('href', '/checkout');
          drawerCheckoutBtn.style.opacity = '1';
          drawerCheckoutBtn.style.pointerEvents = 'auto';
          drawerCheckoutBtn.style.cursor = 'pointer';
        }
      }

      // Bind cart item buttons via event delegation
      cartItemsEl.querySelectorAll('[data-action]').forEach(btn => {
        btn.addEventListener('click', () => {
          const action = (btn as HTMLElement).dataset.action;
          const idx = parseInt((btn as HTMLElement).dataset.idx || '0');
          const cart = getCart();
          if (action === 'plus') {
            if (cart[idx]) cart[idx].qty = (cart[idx].qty || 1) + 1;
          } else if (action === 'minus') {
            if (cart[idx]) {
              cart[idx].qty = (cart[idx].qty || 1) - 1;
              if (cart[idx].qty <= 0) cart.splice(idx, 1);
            }
          } else if (action === 'remove') {
            cart.splice(idx, 1);
          }
          saveCart(cart);
          renderCart();
        });
      });
    }

    // Cart icon opens drawer
    document.getElementById('cart-toggle')?.addEventListener('click', (e) => { e.preventDefault(); openCart(); });
    document.getElementById('cart-close')?.addEventListener('click', closeCart);
    cartOverlay?.addEventListener('click', closeCart);
    document.getElementById('cart-clear')?.addEventListener('click', () => {
      saveCart([]);
      renderCart();
    });
    document.getElementById('cart-continue')?.addEventListener('click', closeCart);

    // Update badges on load and on cart-updated events
    updateCartBadges();
    window.addEventListener('cart-updated', () => {
      updateCartBadges();
      renderCart();
    });

    // Handle "Add to Cart" buttons on product cards
    document.querySelectorAll('.card-cart-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        const b = btn as HTMLElement;
        const handle = b.dataset.product;
        const title = b.dataset.title || '';
        const price = b.dataset.price || '0';
        const image = b.dataset.image || '';
        const cart = getCart();
        const existing = cart.find((i: any) => i.handle === handle);
        if (existing) {
          existing.qty = (existing.qty || 1) + 1;
        } else {
          cart.push({ handle, title, price, image, qty: 1 });
        }
        saveCart(cart);

        // Visual feedback
        const orig = b.innerHTML;
        b.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>';
        b.style.background = 'var(--color-accent)';
        b.style.color = '#fff';
        setTimeout(() => {
          b.innerHTML = orig;
          b.style.background = '';
          b.style.color = '';
        }, 1200);

        openCart();
      });
    });

    // Escape key closes all modals
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeCart();
        closeSearch();
        closeMega();
        closeMobileMenu();
      }
    });

    // Cmd/Ctrl+K opens search
    document.addEventListener('keydown', (e) => {
      if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
        e.preventDefault();
        openSearch();
      }
    });
  </script>
  <!--Start of Tawk.to Script-->
  <script type="text/javascript">
    var Tawk_API = Tawk_API || {}, Tawk_LoadStart = new Date();
    (function() {
      var s1 = document.createElement("script"), s0 = document.getElementsByTagName("script")[0];
      s1.async = true;
      s1.src = 'https://embed.tawk.to/699c74679f81c11c340d9ac3/1ji5ide0f';
      s1.charset = 'UTF-8';
      s1.setAttribute('crossorigin', '*');
      s0.parentNode.insertBefore(s1, s0);
    })();
  </script>
  <!--End of Tawk.to Script-->
</body>
</html>

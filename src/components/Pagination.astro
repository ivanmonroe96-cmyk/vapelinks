---
interface Props {
  currentPage: number;
  totalPages: number;
  baseUrl: string;
}

const { currentPage, totalPages, baseUrl } = Astro.props;

const maxVisible = 5;
let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
let endPage = Math.min(totalPages, startPage + maxVisible - 1);
if (endPage - startPage < maxVisible - 1) {
  startPage = Math.max(1, endPage - maxVisible + 1);
}

const pages = Array.from({ length: endPage - startPage + 1 }, (_, i) => startPage + i);

function pageUrl(page: number) {
  return page === 1 ? baseUrl : `${baseUrl}${baseUrl.includes('?') ? '&' : '?'}page=${page}`;
}
---

{totalPages > 1 && (
  <nav class="pagination" aria-label="Pagination">
    <span class="page-info">Page {currentPage} of {totalPages}</span>

    <a
      href={currentPage > 1 ? pageUrl(currentPage - 1) : undefined}
      class:list={['page-nav', currentPage <= 1 && 'page-nav-disabled']}
      aria-label="Previous page"
    >
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
      <span class="page-nav-label">Previous</span>
    </a>

    <div class="pagination-inner">
      {startPage > 1 && (
        <>
          <a href={pageUrl(1)} class="page-btn">1</a>
          {startPage > 2 && <span class="page-dots">···</span>}
        </>
      )}

      {pages.map(page => (
        <a
          href={pageUrl(page)}
          class:list={['page-btn', page === currentPage && 'page-active']}
          aria-current={page === currentPage ? 'page' : undefined}
        >
          {page}
        </a>
      ))}

      {endPage < totalPages && (
        <>
          {endPage < totalPages - 1 && <span class="page-dots">···</span>}
          <a href={pageUrl(totalPages)} class="page-btn">{totalPages}</a>
        </>
      )}
    </div>

    <a
      href={currentPage < totalPages ? pageUrl(currentPage + 1) : undefined}
      class:list={['page-nav', currentPage >= totalPages && 'page-nav-disabled']}
      aria-label="Next page"
    >
      <span class="page-nav-label">Next</span>
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
    </a>
  </nav>
)}
